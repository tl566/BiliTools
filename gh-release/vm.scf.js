"use strict";var t=require("zlib"),e=require("crypto"),n=require("path"),r=require("fs");require("vm");var i=require("got"),o=require("json5");function a(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}function s(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}})),e.default=t,Object.freeze(e)}var c=s(e),u=s(n),f=s(r),l=a(i),d=s(o);const p=["Ê£í","Ê£íÂîâ","Ê£íËÄ∂","Âä†Ê≤π~","UPÂä†Ê≤π!","ÊîØÊåÅ~","ÊîØÊåÅÊîØÊåÅÔºÅ","ÂÇ¨Êõ¥Âï¶","È°∂È°∂","Áïô‰∏ãËÑöÂç∞~","Âπ≤ÊùØ","bilibiliÂπ≤ÊùØ","o(*Ôø£‚ñΩÔø£*)o","(ÔΩ°ÔΩ•‚àÄÔΩ•)ÔæâÔæûÂó®","(‚óèÀá‚àÄÀá‚óè)","( ‚Ä¢ÃÄ œâ ‚Ä¢ÃÅ )y","(‡∏á ‚Ä¢_‚Ä¢)‡∏á",">.<","^_~"];var g="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},m=function(t){return t&&t.Math==Math&&t},h=m("object"==typeof globalThis&&globalThis)||m("object"==typeof window&&window)||m("object"==typeof self&&self)||m("object"==typeof g&&g)||function(){return this}()||Function("return this")(),y={},_=function(t){try{return!!t()}catch(t){return!0}},w=!_((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),v=!_((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),b=v,$=Function.prototype.call,T=b?$.bind($):function(){return $.apply($,arguments)},S={},I={}.propertyIsEnumerable,O=Object.getOwnPropertyDescriptor,E=O&&!I.call({1:2},1);S.f=E?function(t){var e=O(this,t);return!!e&&e.enumerable}:I;var C,P,x=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},k=v,L=Function.prototype,N=L.bind,R=L.call,A=k&&N.bind(R,R),U=k?function(t){return t&&A(t)}:function(t){return t&&function(){return R.apply(t,arguments)}},j=U,B=j({}.toString),D=j("".slice),G=function(t){return D(B(t),8,-1)},M=_,q=G,F=Object,K=U("".split),H=M((function(){return!F("z").propertyIsEnumerable(0)}))?function(t){return"String"==q(t)?K(t,""):F(t)}:F,J=TypeError,Y=function(t){if(null==t)throw J("Can't call method on "+t);return t},z=H,Q=Y,W=function(t){return z(Q(t))},V=function(t){return"function"==typeof t},X=V,Z=function(t){return"object"==typeof t?null!==t:X(t)},tt=h,et=V,nt=function(t){return et(t)?t:void 0},rt=function(t,e){return arguments.length<2?nt(tt[t]):tt[t]&&tt[t][e]},it=U({}.isPrototypeOf),ot=h,at=rt("navigator","userAgent")||"",st=ot.process,ct=ot.Deno,ut=st&&st.versions||ct&&ct.version,ft=ut&&ut.v8;ft&&(P=(C=ft.split("."))[0]>0&&C[0]<4?1:+(C[0]+C[1])),!P&&at&&(!(C=at.match(/Edge\/(\d+)/))||C[1]>=74)&&(C=at.match(/Chrome\/(\d+)/))&&(P=+C[1]);var lt=P,dt=_,pt=!!Object.getOwnPropertySymbols&&!dt((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&lt&&lt<41})),gt=pt&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,mt=rt,ht=V,yt=it,_t=Object,wt=gt?function(t){return"symbol"==typeof t}:function(t){var e=mt("Symbol");return ht(e)&&yt(e.prototype,_t(t))},vt=String,bt=function(t){try{return vt(t)}catch(t){return"Object"}},$t=V,Tt=bt,St=TypeError,It=function(t){if($t(t))return t;throw St(Tt(t)+" is not a function")},Ot=It,Et=function(t,e){var n=t[e];return null==n?void 0:Ot(n)},Ct=T,Pt=V,xt=Z,kt=TypeError,Lt={exports:{}},Nt=h,Rt=Object.defineProperty,At=function(t,e){try{Rt(Nt,t,{value:e,configurable:!0,writable:!0})}catch(n){Nt[t]=e}return e},Ut=At,jt=h["__core-js_shared__"]||Ut("__core-js_shared__",{}),Bt=jt;(Lt.exports=function(t,e){return Bt[t]||(Bt[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.22.8",mode:"global",copyright:"¬© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.22.8/LICENSE",source:"https://github.com/zloirock/core-js"});var Dt=Y,Gt=Object,Mt=function(t){return Gt(Dt(t))},qt=Mt,Ft=U({}.hasOwnProperty),Kt=Object.hasOwn||function(t,e){return Ft(qt(t),e)},Ht=U,Jt=0,Yt=Math.random(),zt=Ht(1..toString),Qt=function(t){return"Symbol("+(void 0===t?"":t)+")_"+zt(++Jt+Yt,36)},Wt=h,Vt=Lt.exports,Xt=Kt,Zt=Qt,te=pt,ee=gt,ne=Vt("wks"),re=Wt.Symbol,ie=re&&re.for,oe=ee?re:re&&re.withoutSetter||Zt,ae=function(t){if(!Xt(ne,t)||!te&&"string"!=typeof ne[t]){var e="Symbol."+t;te&&Xt(re,t)?ne[t]=re[t]:ne[t]=ee&&ie?ie(e):oe(e)}return ne[t]},se=T,ce=Z,ue=wt,fe=Et,le=function(t,e){var n,r;if("string"===e&&Pt(n=t.toString)&&!xt(r=Ct(n,t)))return r;if(Pt(n=t.valueOf)&&!xt(r=Ct(n,t)))return r;if("string"!==e&&Pt(n=t.toString)&&!xt(r=Ct(n,t)))return r;throw kt("Can't convert object to primitive value")},de=TypeError,pe=ae("toPrimitive"),ge=function(t,e){if(!ce(t)||ue(t))return t;var n,r=fe(t,pe);if(r){if(void 0===e&&(e="default"),n=se(r,t,e),!ce(n)||ue(n))return n;throw de("Can't convert object to primitive value")}return void 0===e&&(e="number"),le(t,e)},me=wt,he=function(t){var e=ge(t,"string");return me(e)?e:e+""},ye=Z,_e=h.document,we=ye(_e)&&ye(_e.createElement),ve=function(t){return we?_e.createElement(t):{}},be=ve,$e=!w&&!_((function(){return 7!=Object.defineProperty(be("div"),"a",{get:function(){return 7}}).a})),Te=w,Se=T,Ie=S,Oe=x,Ee=W,Ce=he,Pe=Kt,xe=$e,ke=Object.getOwnPropertyDescriptor;y.f=Te?ke:function(t,e){if(t=Ee(t),e=Ce(e),xe)try{return ke(t,e)}catch(t){}if(Pe(t,e))return Oe(!Se(Ie.f,t,e),t[e])};var Le={},Ne=w&&_((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),Re=Z,Ae=String,Ue=TypeError,je=function(t){if(Re(t))return t;throw Ue(Ae(t)+" is not an object")},Be=w,De=$e,Ge=Ne,Me=je,qe=he,Fe=TypeError,Ke=Object.defineProperty,He=Object.getOwnPropertyDescriptor;Le.f=Be?Ge?function(t,e,n){if(Me(t),e=qe(e),Me(n),"function"==typeof t&&"prototype"===e&&"value"in n&&"writable"in n&&!n.writable){var r=He(t,e);r&&r.writable&&(t[e]=n.value,n={configurable:"configurable"in n?n.configurable:r.configurable,enumerable:"enumerable"in n?n.enumerable:r.enumerable,writable:!1})}return Ke(t,e,n)}:Ke:function(t,e,n){if(Me(t),e=qe(e),Me(n),De)try{return Ke(t,e,n)}catch(t){}if("get"in n||"set"in n)throw Fe("Accessors not supported");return"value"in n&&(t[e]=n.value),t};var Je=Le,Ye=x,ze=w?function(t,e,n){return Je.f(t,e,Ye(1,n))}:function(t,e,n){return t[e]=n,t},Qe={exports:{}},We=w,Ve=Kt,Xe=Function.prototype,Ze=We&&Object.getOwnPropertyDescriptor,tn=Ve(Xe,"name"),en={EXISTS:tn,PROPER:tn&&"something"===function(){}.name,CONFIGURABLE:tn&&(!We||We&&Ze(Xe,"name").configurable)},nn=V,rn=jt,on=U(Function.toString);nn(rn.inspectSource)||(rn.inspectSource=function(t){return on(t)});var an,sn,cn,un=rn.inspectSource,fn=V,ln=un,dn=h.WeakMap,pn=fn(dn)&&/native code/.test(ln(dn)),gn=Lt.exports,mn=Qt,hn=gn("keys"),yn=function(t){return hn[t]||(hn[t]=mn(t))},_n={},wn=pn,vn=h,bn=U,$n=Z,Tn=ze,Sn=Kt,In=jt,On=yn,En=_n,Cn=vn.TypeError,Pn=vn.WeakMap;if(wn||In.state){var xn=In.state||(In.state=new Pn),kn=bn(xn.get),Ln=bn(xn.has),Nn=bn(xn.set);an=function(t,e){if(Ln(xn,t))throw new Cn("Object already initialized");return e.facade=t,Nn(xn,t,e),e},sn=function(t){return kn(xn,t)||{}},cn=function(t){return Ln(xn,t)}}else{var Rn=On("state");En[Rn]=!0,an=function(t,e){if(Sn(t,Rn))throw new Cn("Object already initialized");return e.facade=t,Tn(t,Rn,e),e},sn=function(t){return Sn(t,Rn)?t[Rn]:{}},cn=function(t){return Sn(t,Rn)}}var An={set:an,get:sn,has:cn,enforce:function(t){return cn(t)?sn(t):an(t,{})},getterFor:function(t){return function(e){var n;if(!$n(e)||(n=sn(e)).type!==t)throw Cn("Incompatible receiver, "+t+" required");return n}}},Un=_,jn=V,Bn=Kt,Dn=w,Gn=en.CONFIGURABLE,Mn=un,qn=An.enforce,Fn=An.get,Kn=Object.defineProperty,Hn=Dn&&!Un((function(){return 8!==Kn((function(){}),"length",{value:8}).length})),Jn=String(String).split("String"),Yn=Qe.exports=function(t,e,n){"Symbol("===String(e).slice(0,7)&&(e="["+String(e).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(e="get "+e),n&&n.setter&&(e="set "+e),(!Bn(t,"name")||Gn&&t.name!==e)&&Kn(t,"name",{value:e,configurable:!0}),Hn&&n&&Bn(n,"arity")&&t.length!==n.arity&&Kn(t,"length",{value:n.arity});try{n&&Bn(n,"constructor")&&n.constructor?Dn&&Kn(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var r=qn(t);return Bn(r,"source")||(r.source=Jn.join("string"==typeof e?e:"")),t};Function.prototype.toString=Yn((function(){return jn(this)&&Fn(this).source||Mn(this)}),"toString");var zn=V,Qn=ze,Wn=Qe.exports,Vn=At,Xn={},Zn=Math.ceil,tr=Math.floor,er=Math.trunc||function(t){var e=+t;return(e>0?tr:Zn)(e)},nr=function(t){var e=+t;return e!=e||0===e?0:er(e)},rr=nr,ir=Math.max,or=Math.min,ar=nr,sr=Math.min,cr=function(t){return t>0?sr(ar(t),9007199254740991):0},ur=function(t){return cr(t.length)},fr=W,lr=function(t,e){var n=rr(t);return n<0?ir(n+e,0):or(n,e)},dr=ur,pr=function(t){return function(e,n,r){var i,o=fr(e),a=dr(o),s=lr(r,a);if(t&&n!=n){for(;a>s;)if((i=o[s++])!=i)return!0}else for(;a>s;s++)if((t||s in o)&&o[s]===n)return t||s||0;return!t&&-1}},gr={includes:pr(!0),indexOf:pr(!1)},mr=Kt,hr=W,yr=gr.indexOf,_r=_n,wr=U([].push),vr=function(t,e){var n,r=hr(t),i=0,o=[];for(n in r)!mr(_r,n)&&mr(r,n)&&wr(o,n);for(;e.length>i;)mr(r,n=e[i++])&&(~yr(o,n)||wr(o,n));return o},br=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],$r=vr,Tr=br.concat("length","prototype");Xn.f=Object.getOwnPropertyNames||function(t){return $r(t,Tr)};var Sr={};Sr.f=Object.getOwnPropertySymbols;var Ir=rt,Or=Xn,Er=Sr,Cr=je,Pr=U([].concat),xr=Ir("Reflect","ownKeys")||function(t){var e=Or.f(Cr(t)),n=Er.f;return n?Pr(e,n(t)):e},kr=Kt,Lr=xr,Nr=y,Rr=Le,Ar=function(t,e,n){for(var r=Lr(e),i=Rr.f,o=Nr.f,a=0;a<r.length;a++){var s=r[a];kr(t,s)||n&&kr(n,s)||i(t,s,o(e,s))}},Ur=_,jr=V,Br=/#|\.prototype\./,Dr=function(t,e){var n=Mr[Gr(t)];return n==Fr||n!=qr&&(jr(e)?Ur(e):!!e)},Gr=Dr.normalize=function(t){return String(t).replace(Br,".").toLowerCase()},Mr=Dr.data={},qr=Dr.NATIVE="N",Fr=Dr.POLYFILL="P",Kr=Dr,Hr=h,Jr=y.f,Yr=ze,zr=function(t,e,n,r){r||(r={});var i=r.enumerable,o=void 0!==r.name?r.name:e;return zn(n)&&Wn(n,o,r),r.global?i?t[e]=n:Vn(e,n):(r.unsafe?t[e]&&(i=!0):delete t[e],i?t[e]=n:Qn(t,e,n)),t},Qr=At,Wr=Ar,Vr=Kr,Xr=function(t,e){var n,r,i,o,a,s=t.target,c=t.global,u=t.stat;if(n=c?Hr:u?Hr[s]||Qr(s,{}):(Hr[s]||{}).prototype)for(r in e){if(o=e[r],i=t.dontCallGetSet?(a=Jr(n,r))&&a.value:n[r],!Vr(c?r:s+(u?".":"#")+r,t.forced)&&void 0!==i){if(typeof o==typeof i)continue;Wr(o,i)}(t.sham||i&&i.sham)&&Yr(o,"sham",!0),zr(n,r,o,t)}},Zr=v,ti=Function.prototype,ei=ti.apply,ni=ti.call,ri="object"==typeof Reflect&&Reflect.apply||(Zr?ni.bind(ei):function(){return ni.apply(ei,arguments)}),ii=V,oi=String,ai=TypeError,si=U,ci=je,ui=function(t){if("object"==typeof t||ii(t))return t;throw ai("Can't set "+oi(t)+" as a prototype")},fi=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=si(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(n,[]),e=n instanceof Array}catch(t){}return function(n,r){return ci(n),ui(r),e?t(n,r):n.__proto__=r,n}}():void 0),li=Le.f,di=V,pi=Z,gi=fi,mi={};mi[ae("toStringTag")]="z";var hi="[object z]"===String(mi),yi=V,_i=G,wi=ae("toStringTag"),vi=Object,bi="Arguments"==_i(function(){return arguments}()),$i=hi?_i:function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=vi(t),wi))?n:bi?_i(e):"Object"==(r=_i(e))&&yi(e.callee)?"Arguments":r},Ti=$i,Si=String,Ii=function(t){if("Symbol"===Ti(t))throw TypeError("Cannot convert a Symbol value to a string");return Si(t)},Oi=function(t,e){return void 0===t?arguments.length<2?"":e:Ii(t)},Ei=Z,Ci=ze,Pi=function(t,e){Ei(e)&&"cause"in e&&Ci(t,"cause",e.cause)},xi=Error,ki=U("".replace),Li=String(xi("zxcasd").stack),Ni=/\n\s*at [^:]*:[^\n]*/,Ri=Ni.test(Li),Ai=function(t,e){if(Ri&&"string"==typeof t&&!xi.prepareStackTrace)for(;e--;)t=ki(t,Ni,"");return t},Ui=x,ji=!_((function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",Ui(1,7)),7!==t.stack)})),Bi=rt,Di=Kt,Gi=ze,Mi=it,qi=fi,Fi=Ar,Ki=function(t,e,n){n in t||li(t,n,{configurable:!0,get:function(){return e[n]},set:function(t){e[n]=t}})},Hi=function(t,e,n){var r,i;return gi&&di(r=e.constructor)&&r!==n&&pi(i=r.prototype)&&i!==n.prototype&&gi(t,i),t},Ji=Oi,Yi=Pi,zi=Ai,Qi=ji,Wi=w,Vi=Xr,Xi=ri,Zi=function(t,e,n,r){var i="stackTraceLimit",o=r?2:1,a=t.split("."),s=a[a.length-1],c=Bi.apply(null,a);if(c){var u=c.prototype;if(Di(u,"cause")&&delete u.cause,!n)return c;var f=Bi("Error"),l=e((function(t,e){var n=Ji(r?e:t,void 0),i=r?new c(t):new c;return void 0!==n&&Gi(i,"message",n),Qi&&Gi(i,"stack",zi(i.stack,2)),this&&Mi(u,this)&&Hi(i,this,l),arguments.length>o&&Yi(i,arguments[o]),i}));l.prototype=u,"Error"!==s?qi?qi(l,f):Fi(l,f,{name:!0}):Wi&&i in c&&(Ki(l,c,i),Ki(l,c,"prepareStackTrace")),Fi(l,c);try{u.name!==s&&Gi(u,"name",s),u.constructor=l}catch(t){}return l}},to=h.WebAssembly,eo=7!==Error("e",{cause:7}).cause,no=function(t,e){var n={};n[t]=Zi(t,e,eo),Vi({global:!0,constructor:!0,arity:1,forced:eo},n)},ro=function(t,e){if(to&&to[t]){var n={};n[t]=Zi("WebAssembly."+t,e,eo),Vi({target:"WebAssembly",stat:!0,constructor:!0,arity:1,forced:eo},n)}};function io(e){try{return t.gzipSync(encodeURIComponent(e)).toString("base64")}catch(t){return"Error: ÂΩìÂâçÂ≠óÁ¨¶‰∏≤‰∏çËÉΩË¢´GzipÂéãÁº©"}}function oo(e){try{const n=t.unzipSync(Buffer.from(e,"base64")).toString();try{return decodeURIComponent(function(t){return t.replace(/\\u([\d\w]{4})/gi,((t,e)=>String.fromCodePoint(parseInt(e,16))))}(n))}catch(t){return unescape(n)}}catch(t){throw new Error("Error: ÂΩìÂâçÂ≠óÁ¨¶‰∏≤‰∏çËÉΩË¢´GzipËß£Âéã")}}no("Error",(function(t){return function(e){return Xi(t,this,arguments)}})),no("EvalError",(function(t){return function(e){return Xi(t,this,arguments)}})),no("RangeError",(function(t){return function(e){return Xi(t,this,arguments)}})),no("ReferenceError",(function(t){return function(e){return Xi(t,this,arguments)}})),no("SyntaxError",(function(t){return function(e){return Xi(t,this,arguments)}})),no("TypeError",(function(t){return function(e){return Xi(t,this,arguments)}})),no("URIError",(function(t){return function(e){return Xi(t,this,arguments)}})),ro("CompileError",(function(t){return function(e){return Xi(t,this,arguments)}})),ro("LinkError",(function(t){return function(e){return Xi(t,this,arguments)}})),ro("RuntimeError",(function(t){return function(e){return Xi(t,this,arguments)}}));var ao=Le.f,so=Kt,co=ae("toStringTag"),uo=h,fo=function(t,e,n){t&&!n&&(t=t.prototype),t&&!so(t,co)&&ao(t,co,{configurable:!0,value:e})};Xr({global:!0},{Reflect:{}}),fo(uo.Reflect,"Reflect",!0);const lo=()=>process.env.QL_BRANCH;function po(){return function(){const t=Object.keys(process.env),e=t.filter((t=>t.startsWith("SCF_"))).length>=10,n=t.filter((t=>t.startsWith("TENCENTCLOUD_"))).length>=3;return e&&n||!0}()||function(){const t=Object.keys(process.env),e=["securityToken","accessKeyID","accessKeySecret","FC_FUNCTION_MEMORY_SIZE","FC_FUNC_CODE_PATH","FC_RUNTIME_VERSION"];return t.filter((t=>e.includes(t))).length>=3||!1}()||global.IS_CFC||!1||global.IS_CFC||!1}const go=Object.prototype.toString;function mo(t,e){return go.call(t)===`[object ${e}]`}function ho(t){return null!==t&&mo(t,"Object")}function yo(t){return mo(t,"String")}function _o(t){return t&&Array.isArray(t)}function wo(){const t=new Date,e=t.getTime(),n=t.getTimezoneOffset()/60;return new Date(e+36e5*(n+8))}function vo(t,e){return Math.ceil(e/t)}function bo(t=6e4,e){t=t||6e4;const n=wo().getTime()+t,r=new Date(n),i=r.getSeconds(),o=r.getMinutes();return So({hours:r.getHours(),minutes:o,seconds:i},e)}function $o(t,e,n){if(n&&"boolean"!=typeof n&&(e=n=void 0),void 0===n&&("boolean"==typeof e?(n=e,e=void 0):"boolean"==typeof t&&(n=t,t=void 0)),void 0===t&&void 0===e?(t=0,e=1):void 0===e&&(e=t,t=0),t>e){const n=t;t=e,e=n}if(n||t%1||e%1){const n=Math.random();return Math.min(t+n*(e-t+parseFloat("1e-"+((n+"").length-1))),e)}return t+Math.floor(Math.random()*(e-t+1))}function To(t="17:30:00-23:40:00",e){const n=t.split("-"),r=n[0].split(":").map((t=>+t)),i=n[1].split(":").map((t=>+t)),o=$o(r[0]??19,i[0]??23);let a=0;a=o==r[0]?$o(r[1],59):o==i[0]?$o(i[1]):$o(59);let s=0;return s=o==r[0]?$o(r[2],59):o==i[0]?$o(i[2]):$o(59),So({seconds:s,hours:o,minutes:a},e)}function So({hours:t,minutes:e,seconds:n},r){let i;switch(n=n||0,r){case"scf":default:i=`${n} ${e} ${t} * * * *`;break;case"fc":i=`${n} ${e} ${t} * * *`;break;case"cfc":i=`corn(${e} ${t} * * *)`}return{value:i,string:`${t}:${e}:${n}`}}function Io(){return`${$o(1,9)}${function(t,e){let n="";for(let e=0;e<t;e++)n+=xo("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ");return e?n.toLowerCase():n}(10,!0)}0`}function Oo(t,e){t.includes(e)||t.push(e)}function Eo(t,e=!1){return ho(t)?Array.isArray(t)?t.map((t=>Eo(t,e))):e?Object.keys(t).reduce(((n,r)=>(n[r]=Eo(t[r],e),n)),{}):Object.assign({},t):t}function Co(t,e){return void 0===t||void 0===e?t||e:ho(t)&&ho(e)?Array.isArray(t)&&Array.isArray(e)?t.concat(e):Object.keys(e).reduce(((n,r)=>(n[r]=Co(t[r],e[r]),n)),t):e}function Po(t){if(!ho(t)&&!_o(t))return t;const e=new URLSearchParams;return Array.isArray(t)||(t=Object.entries(t)),t.forEach((([t,n])=>{ho(n)?e.append(t,JSON.stringify(n)):e.append(t,String(n))})),e.toString()}function xo(t){return t[$o(t.length-1)]}function ko(t){return t&&t.map((t=>Number(t))).filter((t=>t>0&&t%1==0))}function Lo(t,e=!0){return e?t.toLocaleString("zh-CN",{hour12:!1}):t.toLocaleString("zh-CN",{hour12:!1,hour:"numeric",minute:"numeric",second:"numeric"})}function No(t="info"){const e=["error","warn","info","verbose","debug"],n=e.indexOf(t);return n>0?e.slice(0,n+1):e}function Ro(t){return u.resolve(process.cwd(),t)}class Ao{static pushValue="";month=wo().getMonth()+1;errorFile=Ro(`./logs/bt_error-${this.month}.log`);logFile=Ro(`./logs/bt_combined-${this.month}.log`);noFile=!1;constructor(t={console:"info",file:"info",push:"info"},e="default"){this.options=t,this.name=e,this.consoleLeval=No(this.options.console),this.fileLeval=No(this.options.file),this.pushLeval=No(this.options.push),this.noFile=lo()||po(),this.noFile||this.createLogFile()}log({level:t},e){const n=wo(),r=`[${t} ${Lo(n,!1)}] ${e}\n`,i=["error","warn"].includes(t);this.consoleLeval.includes(t)&&this.Conslole(r,i),!this.noFile&&this.fileLeval.includes(t)&&this.File(`[${t} ${Lo(n,!0)}] ${e}\n`,i),this.pushLeval.includes(t)&&this.Push(r)}error(t){this.log({level:"error"},t)}warn(t){this.log({level:"warn"},t)}info(t){this.log({level:"info"},t)}verbose(t){this.log({level:"verbose"},t)}debug(t){this.log({level:"debug"},t)}Conslole(t,e){e?process.stderr.write(t):process.stdout.write(t)}File(t,e){e&&f.appendFileSync(this.errorFile,t,"utf-8"),f.appendFileSync(this.logFile,t,"utf-8")}Push(t){Ao.pushValue+=t}createLogFile(){const t=Ro("./logs");f.existsSync(t)||f.mkdirSync(t)}}const Uo=new Ao({console:"debug",file:"debug",push:"debug"});class jo{static configFileName=function(){const t=lo()?"cat_bili_config":"config",e=".json",{BILITOOLS_FILE_NAME:n}=process.env;return n?n.endsWith(e)?n:`${n}.json`:t+e}();static isQingLongPanel=lo()}const Bo=d.default?d.default:d;function Do(t){try{let e;if((r.existsSync(t)||r.existsSync(t+="5"))&&(e=r.readFileSync(t,"utf-8")),!e)return;return Uo.verbose(`ËØªÂèñÈÖçÁΩÆÊñá‰ª∂ ${t}`),Bo.parse(e)}catch(t){!function(t){if(!yo(t))return;if(t.includes("SyntaxError: JSON5"))throw Uo.error(t),new SyntaxError("ÈÖçÁΩÆÊñá‰ª∂Â≠òÂú®Ôºå‰ΩÜÊòØÊó†Ê≥ïËß£ÊûêÔºÅÂèØËÉΩ JSON5 Ê†ºÂºè‰∏çÊ≠£Á°ÆÔºÅ");throw new Error(t)}(t.message)}}const Go=t=>u.resolve(process.cwd(),t),Mo=t=>u.resolve(__dirname,"../",t),qo=Array.from(new Set([Go("./config/config.dev.json"),Go(`./config/${jo.configFileName}`),Go(`./${jo.configFileName}`),Mo(`./config/${jo.configFileName}`),Mo(`./${jo.configFileName}`)])),Fo=["./config.json",Go("./config/config.json")];function Ko(t){let e;const n=Array.isArray(t);if(e=n?t:t.account.filter((t=>t.cookie)),0===e.length)return;if(jo.isQingLongPanel)return function(t){const e=process.argv.find((t=>t.includes("--item")||t.includes("-i")||t.includes("-I")));if(!e)return t[0];const n=Number(e.split("=")[1])-1;return!n||n>=t.length||n<0?(Uo.warn("‰ºº‰πéÊÉ≥Ë¶ÅÊåáÂÆö‰∏Ä‰∏™‰∏çÂ≠òÂú®ÁöÑÁî®Êà∑ÔºåÊàë‰ª¨Â∞ÜÊåáÂÆöÁ¨¨‰∏Ä‰∏™Áî®Êà∑"),t[0]):t[n]}(e);Uo.warn("Âú®ÂçïÁî®Êà∑Âú∫ÊôØ‰∏ãÈÖçÁΩÆ‰∫ÜÂ§öÁî®Êà∑ÔºåÊàë‰ª¨Â∞ÜÊîæÂºÉÂ§ö‰ΩôÁöÑÈÖçÁΩÆ");const r=e[0];return n||(r.message=Object.assign(t.message||{},r.message)),r}function Ho(){if(globalThis.BILITOOLS_CONFIG)return globalThis.BILITOOLS_CONFIG;jo.isQingLongPanel&&qo.splice(0,1,...Fo);for(let t=0;t<qo.length;t++){const e=Do(qo[t]);if(e)return e}return(()=>{const{BILITOOLS_CONFIG:t,BILI_SCF_CONFIG:e,BILI_CONFIG:n}=process.env,r=t||e||n;if(r)try{return Bo.parse(oo(r))}catch{throw new Error("ÁéØÂ¢É‰∏≠ÁöÑÈÖçÁΩÆ‰∏çÊòØÊúâÊïàÁöÑ JSON Â≠óÁ¨¶‰∏≤ÔºÅ")}})()}function Jo(t){if(!t)throw new Error("Ëé∑ÂèñÈÖçÁΩÆÂ§±Ë¥•ÔºÅÊú™ÊâæÂà∞ÈÖçÁΩÆÊñá‰ª∂ÔºÅ");if(function(t){if(Array.isArray(t))return!0;return Boolean(t.account&&t.account.length)}(t)){const e=Ko(t);if(e)return e}if(!t.cookie)throw new Error("ÈÖçÁΩÆÊñá‰ª∂‰∏≠Ê≤°Êúâ cookieÔºÅ");return t}function Yo(t){return t?t.split("; ").map((t=>t.split("="))):[]}function zo(t,e){return t?e&&0!==e.length?function(t){const e=Object.keys(t).reduce(((e,n)=>e+`${n}=${t[n]}; `),"");return e.substring(0,e.length-2||0)}(function(t,e){const n=Yo(null==e?void 0:e[0]).filter((t=>2===t.length)),r=Yo(t).concat(n).filter((t=>2===t.length)),i={};for(const t of r)i[t[0]]?i[t[0]]=t[1]:Object.defineProperty(i,t[0],{value:t[1],enumerable:!0,writable:!0});return i}(t,e)):t:""}function Qo(t,e){if(!t)return null;const n=`(?:^|)${e}=([^;]*)(?:;|$)`,r=t.match(n);return r?r[1]:null}function Wo(t){return Qo(t,"bili_jct")||""}function Vo(t){return Qo(t,"LIVE_BUVID")||""}const Xo={cookie:"",message:{email:{host:"smtp.163.com",port:465},pushplusToken:process.env.PUSHPLUS_TOKEN,api:void 0},function:{silver2Coin:!0,liveSignTask:!0,addCoins:!0,mangaSign:!1,shareAndWatch:!0,supGroupSign:!1,liveSendMessage:!1,taskReward:!0,charging:!1,getVipPrivilege:!1,giveGift:!1,matchGame:!1,liveLottery:!1,liveRedPack:!1,liveIntimacy:!1},apiDelay:[2,6],userAgent:"",dailyRunTime:"17:30:00-23:40:00",targetLevel:void 0,stayCoins:void 0,targetCoins:void 0,customizeUp:void 0,giftUp:void 0,coinRetryNum:void 0,chargeUpId:void 0,chargePresetTime:void 0,matchCoins:void 0,matchSelection:void 0,matchDiff:void 0,match:{coins:5,selection:1,diff:0},charge:{mid:0,presetTime:31},gift:{mids:[]},coin:{customizeUp:[],retryNum:4,targetLevel:6,stayCoins:0,targetCoins:5},sls:{name:"",description:"",region:"ap-chengdu",dailyRunTime:"17:30:00-23:40:00"},lottery:{excludeAward:["Ëà∞","Ëàπ","Ëà™Êµ∑","‰ª£ÈáëÂà∏","‰ºòÊÉ†Âà∏","Ëá™Êãç","ÁÖß","ÂÜôÁúü","Âõæ","ÊèêÁù£","ËΩ¶ËΩ¶‰∏ÄÂ±Ä","ÂÜçÊù•‰∏ÄÂ±Ä","Ê∏∏ÊàèÈÅìÂÖ∑"],includeAward:["Ë∞¢"],blackUid:[65566781,1277481241,1643654862,603676925],isMoveTag:!0,moveTag:"Â§©ÈÄâÊó∂Âàª",pageNum:2,actFollowMsg:"read",scanFollow:void 0,skipNeedFollow:!1},redPack:{},intimacy:{liveSendMessage:!0,liveShare:!0,liveLike:!0,whiteList:[],blackList:[]},BILIJCT:"",USERID:0};function Zo(){return Eo(Xo,!0)}function ta(t){return function(t){!function(t){t.BILIJCT=Wo(t.cookie),t.USERID=function(t){return Number(Qo(t,"DedeUserID"))||0}(t.cookie)}(t);const{coin:e,gift:n,charge:r}=t;_o(t.apiDelay)?t.apiDelay=ko(t.apiDelay):t.apiDelay=[Number(t.apiDelay)];e.customizeUp=ko(e.customizeUp),n.mids=ko(n.mids),0===n.mids.length&&(n.mids=e.customizeUp);r.mid||(r.mid=t.USERID);return t}(function(t){return Object.keys(ea).forEach((e=>{if(void 0!==t[e]){const[n,r]=ea[e];t[n]=t[n]||{},t[n][r]=t[e]}delete t[e]})),t}(Co(Zo(),t)))}const ea={targetLevel:["coin","targetLevel"],stayCoins:["coin","stayCoins"],targetCoins:["coin","targetCoins"],customizeUp:["coin","customizeUp"],coinRetryNum:["coin","retryNum"],giftUp:["gift","mids"],chargeUpId:["charge","mid"],chargePresetTime:["charge","presetTime"],matchCoins:["match","coins"],matchSelection:["match","selection"],matchDiff:["match","diff"]};class na{constructor(t){this.COOKIE=t.cookie,this.BILIJCT=t.BILIJCT,this.USERID=t.USERID,this.USER_AGENT=t.userAgent,this.BILI_API_DELAY=t.apiDelay;const e=t.message;this.MESSAGE_API=e.api,this.PUSHPLUS_TOKEN=e.pushplusToken;const n=t.coin;this.BILI_CUSTOMIZE_UP=n.customizeUp,this.BILI_COIN_RETRY_NUM=n.retryNum,this.BILI_TARGET_LEVEL=n.targetLevel,this.BILI_STAY_COINS=n.stayCoins,this.BILI_TARGET_COINS=n.targetCoins;const r=t.gift;this.BILI_GIFT_UP=r.mids;const i=t.charge;this.CHARGE_ID=i.mid,this.CHARGE_PRESET_TIME=i.presetTime;const o=t.match;this.MATCH_COINS=o.coins,this.MATCH_SELECTION=o.selection,this.MATCH_DIFF=o.diff}}let ra;const ia=new Proxy({},{get:(t,e)=>(ra||aa(),Reflect.get(ra,e)),set:(t,e,n)=>"config"===e&&n?(aa(n),!0):Reflect.set(ra,e,n)});let oa=null;function aa(t){t||(t=Jo(Ho()));const e=ta(t);ra={...new na(Jo(e)),...e},oa=class extends class{static money=0;static coinsTask=5;static share=!1;static watch=!1;static currentStartFun=0;static bCoinCouponBalance=0;static vipType=0;static userLevel=0}{},oa.coinsTask=ra.BILI_TARGET_COINS}function sa(t,e){const n=function(t,e){if(t&&e)return $o(t,e);if(t)return t;const n=ia.BILI_API_DELAY;if(1===n.length)return 1e3*n[0];return 1e3*$o(n[0]||2,n[1]||6)}(t,e);return new Promise((t=>{setTimeout((()=>{t(n)}),n)}))}var ca=!_((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),ua=Kt,fa=V,la=Mt,da=ca,pa=yn("IE_PROTO"),ga=Object,ma=ga.prototype,ha=da?ga.getPrototypeOf:function(t){var e=la(t);if(ua(e,pa))return e[pa];var n=e.constructor;return fa(n)&&e instanceof n?n.prototype:e instanceof ga?ma:null},ya={},_a=vr,wa=br,va=Object.keys||function(t){return _a(t,wa)},ba=w,$a=Ne,Ta=Le,Sa=je,Ia=W,Oa=va;ya.f=ba&&!$a?Object.defineProperties:function(t,e){Sa(t);for(var n,r=Ia(e),i=Oa(e),o=i.length,a=0;o>a;)Ta.f(t,n=i[a++],r[n]);return t};var Ea,Ca=rt("document","documentElement"),Pa=je,xa=ya,ka=br,La=_n,Na=Ca,Ra=ve,Aa=yn("IE_PROTO"),Ua=function(){},ja=function(t){return"<script>"+t+"<\/script>"},Ba=function(t){t.write(ja("")),t.close();var e=t.parentWindow.Object;return t=null,e},Da=function(){try{Ea=new ActiveXObject("htmlfile")}catch(t){}var t,e;Da="undefined"!=typeof document?document.domain&&Ea?Ba(Ea):((e=Ra("iframe")).style.display="none",Na.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(ja("document.F=Object")),t.close(),t.F):Ba(Ea);for(var n=ka.length;n--;)delete Da.prototype[ka[n]];return Da()};La[Aa]=!0;var Ga=Object.create||function(t,e){var n;return null!==t?(Ua.prototype=Pa(t),n=new Ua,Ua.prototype=null,n[Aa]=t):n=Da(),void 0===e?n:xa.f(n,e)},Ma=It,qa=v,Fa=U(U.bind),Ka={},Ha=Ka,Ja=ae("iterator"),Ya=Array.prototype,za=$i,Qa=Et,Wa=Ka,Va=ae("iterator"),Xa=function(t){if(null!=t)return Qa(t,Va)||Qa(t,"@@iterator")||Wa[za(t)]},Za=T,ts=It,es=je,ns=bt,rs=Xa,is=TypeError,os=T,as=je,ss=Et,cs=function(t,e){return Ma(t),void 0===e?t:qa?Fa(t,e):function(){return t.apply(e,arguments)}},us=T,fs=je,ls=bt,ds=function(t){return void 0!==t&&(Ha.Array===t||Ya[Ja]===t)},ps=ur,gs=it,ms=function(t,e){var n=arguments.length<2?rs(t):e;if(ts(n))return es(Za(n,t));throw is(ns(t)+" is not iterable")},hs=Xa,ys=function(t,e,n){var r,i;as(t);try{if(!(r=ss(t,"return"))){if("throw"===e)throw n;return n}r=os(r,t)}catch(t){i=!0,r=t}if("throw"===e)throw n;if(i)throw r;return as(r),n},_s=TypeError,ws=function(t,e){this.stopped=t,this.result=e},vs=ws.prototype,bs=function(t,e,n){var r,i,o,a,s,c,u,f=n&&n.that,l=!(!n||!n.AS_ENTRIES),d=!(!n||!n.IS_ITERATOR),p=!(!n||!n.INTERRUPTED),g=cs(e,f),m=function(t){return r&&ys(r,"normal",t),new ws(!0,t)},h=function(t){return l?(fs(t),p?g(t[0],t[1],m):g(t[0],t[1])):p?g(t,m):g(t)};if(d)r=t;else{if(!(i=hs(t)))throw _s(ls(t)+" is not iterable");if(ds(i)){for(o=0,a=ps(t);a>o;o++)if((s=h(t[o]))&&gs(vs,s))return s;return new ws(!1)}r=ms(t,i)}for(c=r.next;!(u=us(c,r)).done;){try{s=h(u.value)}catch(t){ys(r,"throw",t)}if("object"==typeof s&&s&&gs(vs,s))return s}return new ws(!1)},$s=Xr,Ts=it,Ss=ha,Is=fi,Os=Ar,Es=Ga,Cs=ze,Ps=x,xs=Ai,ks=Pi,Ls=bs,Ns=Oi,Rs=ji,As=ae("toStringTag"),Us=Error,js=[].push,Bs=function(t,e){var n,r=arguments.length>2?arguments[2]:void 0,i=Ts(Ds,this);Is?n=Is(new Us,i?Ss(this):Ds):(n=i?this:Es(Ds),Cs(n,As,"Error")),void 0!==e&&Cs(n,"message",Ns(e)),Rs&&Cs(n,"stack",xs(n.stack,1)),ks(n,r);var o=[];return Ls(t,js,{that:o}),Cs(n,"errors",o),n};Is?Is(Bs,Us):Os(Bs,Us,{name:!0});var Ds=Bs.prototype=Es(Us.prototype,{constructor:Ps(1,Bs),message:Ps(1,""),name:Ps(1,"AggregateError")});$s({global:!0,constructor:!0,arity:2},{AggregateError:Bs});var Gs={},Ms=It,qs=function(t){var e,n;this.promise=new t((function(t,r){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=r})),this.resolve=Ms(e),this.reject=Ms(n)};Gs.f=function(t){return new qs(t)};var Fs,Ks=T,Hs=It,Js=rt,Ys=Gs,zs=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},Qs=bs;Xr({target:"Promise",stat:!0},{any:function(t){var e=this,n=Js("AggregateError"),r=Ys.f(e),i=r.resolve,o=r.reject,a=zs((function(){var r=Hs(e.resolve),a=[],s=0,c=1,u=!1;Qs(t,(function(t){var f=s++,l=!1;c++,Ks(r,e,t).then((function(t){l||u||(u=!0,i(t))}),(function(t){l||u||(l=!0,a[f]=t,--c||o(new n(a,"No one promise resolved")))}))})),--c||o(new n(a,"No one promise resolved"))}));return a.error&&o(a.value),r.promise}}),function(t){t[t.SUCCESS=0]="SUCCESS",t[t["Â∫îÁî®Á®ãÂ∫è‰∏çÂ≠òÂú®ÊàñÂ∑≤Ë¢´Â∞ÅÁ¶Å"]=-1]="Â∫îÁî®Á®ãÂ∫è‰∏çÂ≠òÂú®ÊàñÂ∑≤Ë¢´Â∞ÅÁ¶Å",t[t["Access KeyÈîôËØØ"]=-2]="Access KeyÈîôËØØ",t[t["APIÊ†°È™åÂØÜÂåôÈîôËØØ"]=-3]="APIÊ†°È™åÂØÜÂåôÈîôËØØ",t[t["Ë∞ÉÁî®ÊñπÂØπËØ•MethodÊ≤°ÊúâÊùÉÈôê"]=-4]="Ë∞ÉÁî®ÊñπÂØπËØ•MethodÊ≤°ÊúâÊùÉÈôê",t[t["Ë¥¶Âè∑Êú™ÁôªÂΩï"]=-101]="Ë¥¶Âè∑Êú™ÁôªÂΩï",t[t["Ë¥¶Âè∑Ë¢´Â∞ÅÂÅú"]=-102]="Ë¥¶Âè∑Ë¢´Â∞ÅÂÅú",t[t["ÁßØÂàÜ‰∏çË∂≥"]=-103]="ÁßØÂàÜ‰∏çË∂≥",t[t["Á°¨Â∏Å‰∏çË∂≥"]=-104]="Á°¨Â∏Å‰∏çË∂≥",t[t["È™åËØÅÁ†ÅÈîôËØØ"]=-105]="È™åËØÅÁ†ÅÈîôËØØ",t[t["Ë¥¶Âè∑ÈùûÊ≠£Âºè‰ºöÂëòÊàñÂú®ÈÄÇÂ∫îÊúü"]=-106]="Ë¥¶Âè∑ÈùûÊ≠£Âºè‰ºöÂëòÊàñÂú®ÈÄÇÂ∫îÊúü",t[t["Â∫îÁî®‰∏çÂ≠òÂú®ÊàñËÄÖË¢´Â∞ÅÁ¶Å"]=-107]="Â∫îÁî®‰∏çÂ≠òÂú®ÊàñËÄÖË¢´Â∞ÅÁ¶Å",t[t["Êú™ÁªëÂÆöÊâãÊú∫?"]=-108]="Êú™ÁªëÂÆöÊâãÊú∫?",t[t["Êú™ÁªëÂÆöÊâãÊú∫"]=-110]="Êú™ÁªëÂÆöÊâãÊú∫",t[t["csrf Ê†°È™åÂ§±Ë¥•"]=-111]="csrf Ê†°È™åÂ§±Ë¥•",t[t["Á≥ªÁªüÂçáÁ∫ß‰∏≠"]=-112]="Á≥ªÁªüÂçáÁ∫ß‰∏≠",t[t["Ë¥¶Âè∑Â∞öÊú™ÂÆûÂêçËÆ§ËØÅ"]=-113]="Ë¥¶Âè∑Â∞öÊú™ÂÆûÂêçËÆ§ËØÅ",t[t["ËØ∑ÂÖàÁªëÂÆöÊâãÊú∫"]=-114]="ËØ∑ÂÖàÁªëÂÆöÊâãÊú∫",t[t["ËØ∑ÂÖàÂÆåÊàêÂÆûÂêçËÆ§ËØÅ"]=-115]="ËØ∑ÂÖàÂÆåÊàêÂÆûÂêçËÆ§ËØÅ"}(Fs||(Fs={}));const Ws="https://account.bilibili.com",Vs="https://live.bilibili.com",Xs="https://space.bilibili.com",Zs="https://message.bilibili.com",tc="https://www.bilibili.com",ec="https://www.bilibili.com/",nc="https://account.bilibili.com",rc="https://api.live.bilibili.com",ic="https://api.bilibili.com",oc="https://manga.bilibili.com",ac="https://api.vc.bilibili.com",sc={"user-agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.41 Safari/537.36 Edg/101.0.1210.32","content-type":"application/x-www-form-urlencoded; charset=UTF-8","accept-language":"zh-CN,zh;q=0.9","accept-encoding":"gzip, deflate, br"},cc=(t,e)=>{const{isTransformResponse:n,isReturnNativeResponse:r}=e;if(r)return t;if(!1===n)return t.body;const{body:i}=t;if(e.isJsonp&&yo(i))return function(t){const e=t.replace(/^\w+\(/,"").replace(/\)$/,"");return JSON.parse(e)}(i);try{if(yo(i)&&i.startsWith("{"))return JSON.parse(i)}catch{}return i};class uc{name="VGot";constructor(t){t.baseURL&&(t.prefixUrl=t.baseURL),this.options=t,this.gotInstance=l.default.extend(t,{hooks:{afterResponse:[t=>{const{requestOptions:e}=t.request.options;var n;null!=e&&e.withBiliCookie&&(ia.COOKIE=zo(ia.COOKIE,(null===(n=t.headers)||void 0===n?void 0:n["set-cookie"])||[]));return t}]}})}request(t){const{requestOptions:e={},headers:n={}}=this.options;return t.requestOptions=Object.assign({},e,t.requestOptions),t.headers=function(t={},e={}){function n(t){return Object.keys(t).reduce(((e,n)=>(e[n.toLowerCase()]=t[n],e)),{})}return Object.assign({},n(t),n(e))}(n,t.headers),e.withBiliCookie&&(t.headers.Cookie=ia.COOKIE),e.retry&&(t.retry=e.retry),t=function(t){yo(t.url)||(t.url=t.url.toString()),ho(t.params)&&!yo(t.searchParams)&&(t.searchParams={...t.searchParams,...t.params});const e=t.headers["content-type"],n=null==e?void 0:e.startsWith("application/x-www-form-urlencoded");function r(e){t.agent||(t.agent={}),t.agent[e]=t[`${e}Agent`]}return ho(t.data)&&(n?t.body=Po(t.data):t.json=t.data),yo(t.data)&&n&&(t.body=t.data),t.httpAgent&&r("http"),t.httpsAgent&&r("https"),t.url&&t.url.startsWith("/")&&(t.url=t.url.substring(1)),t}(t),new Promise(((e,n)=>{this.gotInstance(t).then((r=>{{"function"!=typeof cc;try{const n=cc(r,t.requestOptions);e(n)}catch(t){n(t||new Error("ËØ∑Ê±ÇÈîôËØØ!"))}}})).catch((t=>{t.response&&(t.response.status=t.response.statusCode),n(t)}))}))}get(t,e){return yo(t)?this.request({...e,method:"GET",url:t}):this.request({...t,method:"GET"})}post(t,e,n){return yo(t)?this.request({...n,method:"POST",url:t,data:e}):this.request({...t,method:"POST"})}put(t,e,n){return this.request({...n,method:"PUT",url:t,data:e})}delete(t,e,n){return this.request({...n,method:"DELETE",url:t,data:e})}patch(t,e,n){return this.request({...n,method:"PATCH",url:t,data:e})}}function fc(t){return new uc(Co({timeout:1e4,headers:{"content-type":sc["content-type"],"user-agent":sc["user-agent"],"accept-language":sc["accept-language"],"accept-encoding":sc["accept-encoding"]},requestOptions:{isTransformResponse:!0,ignoreCancelToken:!0,withBiliCookie:!0}},t||{}))}const lc=fc({requestOptions:{withBiliCookie:!1}}),dc=fc();lc.name;const pc=async t=>{Uo.warn(t||"SCF‰ªé6.1Âè∑ÂÖ∂Â∞Ü‰∏çÂÜçÊã•ÊúâÂÖçË¥πÈ¢ùÂ∫¶ÔºåÊöÇÊó∂ÂèØ‰ª•Ë¥≠‰π∞1ÂÖÉÈ¢ùÂ∫¶ÔºåËØ∑Ëá™Ë°åË¥≠‰π∞ÔºåË∞¢Ë∞¢ÔºÅ")};function gc(t){const e=function(){const t=ia.function;return t.addCoins||t.shareAndWatch||(t.taskReward=!1),t.liveIntimacy&&(t.liveSendMessage=!1),t}();return t.map((t=>e[t.name]?t:null)).filter((t=>t))}Uo.info("ÂºÄÂßãÊâßË°åÁΩëÁªú‰ª£Á†Å"),Uo.info("ÂΩìÂâçÁâàÊú¨„Äêv0.5.3„Äë"),(async()=>{try{"heart_bili_timer"===event.TriggerName?VMThis.message=await async function(t,e){pc();const{liveHeartHandle:n}=await Promise.resolve().then((function(){return hf}));return await n({event:t,context:e,slsType:"scf"})}(event,context):(VMThis.message=await async function(t,e){pc();const{dailyHandle:n}=await Promise.resolve().then((function(){return hf}));return await n({event:t,context:e,slsType:"scf"})}(event,context),VMThis.resolve(VMThis.message))}catch(t){VMThis.reject(t)}})();let mc={};function hc(){const t=ia.message||{};mc=function(t={}){return mc.SCKEY="",mc.BARK_PUSH="",mc.BARK_SOUND="",mc.BARK_GROUP="QingLong",mc.TG_BOT_TOKEN="",mc.TG_USER_ID="",mc.TG_PROXY_HOST="",mc.TG_PROXY_PORT="",mc.TG_PROXY_AUTH="",mc.TG_API_HOST="api.telegram.org",mc.DD_BOT_TOKEN="",mc.DD_BOT_SECRET="",mc.QYWX_KEY="",mc.QYWX_AM="",mc.IGOT_PUSH_KEY="",mc.PUSH_PLUS_TOKEN="",mc.PUSH_PLUS_USER="",mc.QQ_SKEY="",mc.QQ_MODE="",t}(mc),["GOBOT_URL","GOBOT_TOKEN","GOBOT_QQ","SCKEY","QQ_SKEY","QQ_MODE","BARK_PUSH","BARK_SOUND","BARK_GROUP","TG_BOT_TOKEN","TG_USER_ID","TG_PROXY_AUTH","TG_PROXY_HOST","TG_PROXY_PORT","TG_API_HOST","DD_BOT_TOKEN","DD_BOT_SECRET","QYWX_KEY","QYWX_AM","IGOT_PUSH_KEY","PUSH_PLUS_TOKEN","PUSH_PLUS_USER"].forEach((e=>{const n=t[(r=e,r.toLowerCase().replace(/_(\w)/g,((t,e)=>e.toUpperCase())))]||t[e]||process.env[e];var r;n&&(mc[e]=n)})),ia.PUSHPLUS_TOKEN&&(mc.PUSH_PLUS_TOKEN=ia.PUSHPLUS_TOKEN)}async function yc(t,e){var n;const r=null===(n=ia.message)||void 0===n?void 0:n.email;if(!(r&&r.pass&&r.from&&r.host))return;const{createTransport:i}=await Promise.resolve().then((function(){return s(require("nodemailer"))})),o=Number(r.port)||465,a=i({host:r.host,port:o,secure:465===o,auth:{user:r.from,pass:r.pass}}),c=await a.sendMail({from:`${t} <${r.from}>`,to:r.to,subject:t,headers:{"Content-Type":"text/plain; charset=utf-8"},text:e.replace(/\n/g,"\r\n")});Uo.info(`ÈÇÆ‰ª∂Ê∂àÊÅØÂ∑≤ÂèëÈÄÅ: ${c.messageId}`)}async function _c(t,e){try{const n=ia.MESSAGE_API;if(!n)return;const r=n.replace("{title}",t).replace("{text}",e);await lc.get(r)}catch(t){Uo.info(`Ëá™ÂÆö‰πâÊé•Âè£Ê∂àÊÅØÂèëÈÄÅÂ§±Ë¥•: ${t}`),Uo.error(t)}}function wc(t,e,n=2100){return new Promise((r=>{const i=mc.SCKEY;if(i){e=e.replace(/[\n\r]/g,"\n\n");const o={url:i.includes("SCT")?`https://sctapi.ftqq.com/${i}.send`:`https://sc.ftqq.com/${i}.send`,params:`text=${t}&desp=${e}`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};setTimeout((()=>{lc.post(o).then((t=>{0===t.errno||0===t.data.errno?Uo.info("serverÈÖ±ÂèëÈÄÅÈÄöÁü•Ê∂àÊÅØÊàêÂäüüéâ"):1024===t.errno?Uo.info(`serverÈÖ±ÂèëÈÄÅÈÄöÁü•Ê∂àÊÅØÂºÇÂ∏∏: ${t.errmsg}`):Uo.info(`serverÈÖ±ÂèëÈÄÅÈÄöÁü•Ê∂àÊÅØÂºÇÂ∏∏\n${JSON.stringify(t)}`)})).catch((t=>{Uo.info("ÂèëÈÄÅÈÄöÁü•Ë∞ÉÁî®APIÂ§±Ë¥•ÔºÅÔºÅ"),Uo.info(t)})).finally((()=>{r("")}))}),n)}else r("")}))}function vc(t,e){return new Promise((n=>{const{QQ_SKEY:r,QQ_MODE:i}=mc;if(r){const o={url:`https://push.xuthus.cc/${i}/${r}`,headers:{"Content-Type":"application/json"},data:{},params:{}};t=t.replace(/‰∫¨Ë±Ü/g,"Ë±ÜË±Ü"),e=(e=(e=e.replace(/‰∫¨Ë±Ü/g,"")).replace(/üê∂/g,"")).replace(/Á∫¢ÂåÖ/g,"HÂåÖ"),"email"===i?o.data={t:t,c:e}:o.params=`${t}\n\n${e}`;const a=function(t){switch(t){case"send":return"‰∏™‰∫∫";case"group":return"QQÁæ§";case"wx":return"ÂæÆ‰ø°";case"ww":return"‰ºÅ‰∏öÂæÆ‰ø°";case"email":return"ÈÇÆ‰ª∂";default:return"Êú™Áü•ÊñπÂºè"}};lc.post(o).then((t=>{200===t.code?Uo.info(`ÈÖ∑Êé®ÂèëÈÄÅ${a(i)}ÈÄöÁü•Ê∂àÊÅØÊàêÂäüüéâ`):400===t.code?Uo.info(`QQÈÖ∑Êé®(Cool Push)ÂèëÈÄÅ${a(i)}Êé®ÈÄÅÂ§±Ë¥•Ôºö${t.msg}`):503===t.code?Uo.info(`QQÈÖ∑Êé®Âá∫ÈîôÔºå${t.message}Ôºö${t.data}`):Uo.info(`ÈÖ∑Êé®Êé®ÈÄÅÂºÇÂ∏∏: ${JSON.stringify(t)}`)})).catch((t=>{Uo.info(`ÂèëÈÄÅ${a(i)}ÈÄöÁü•Ë∞ÉÁî®APIÂ§±Ë¥•ÔºÅÔºÅ`),Uo.info(t)})).finally((()=>{n("")}))}else n("")}))}function bc(t,e,n={}){return new Promise((r=>{const{BARK_PUSH:i,BARK_SOUND:o,BARK_GROUP:a}=mc;if(i){const s={url:`${i}/${encodeURIComponent(t)}/${encodeURIComponent(e)}?sound=${o}&group=${a}&${Po(n)}`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};lc.get(s).then((t=>{200===t.code?Uo.info("Bark APPÂèëÈÄÅÈÄöÁü•Ê∂àÊÅØÊàêÂäüüéâ"):Uo.info(`Bark APPÂèëÈÄÅÈÄöÂ§±Ë¥•Ôºö${t.message}`)})).catch((t=>{Uo.info("Bark APPÂèëÈÄÅÈÄöÁü•Ë∞ÉÁî®APIÂ§±Ë¥•ÔºÅÔºÅ"),Uo.error(t)})).finally((()=>{r("")}))}r("")}))}function $c(t,e){return new Promise((async n=>{const{TG_BOT_TOKEN:r,TG_USER_ID:i,TG_API_HOST:o,TG_PROXY_HOST:a,TG_PROXY_PORT:c,TG_PROXY_AUTH:u}=mc;if(r&&i){const f={url:`https://${o}/bot${r}/sendMessage`,data:`chat_id=${i}&text=${t}\n\n${e}&disable_web_page_preview=true`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};if(a&&c){const t=(await Promise.resolve().then((function(){return s(require("tunnel"))}))).httpsOverHttp({proxy:{host:a,port:+c,proxyAuth:u},maxSockets:1});Object.assign(f,{httpsAgent:t})}lc.post(f).then((t=>{t.ok?Uo.info("TelegramÂèëÈÄÅÈÄöÁü•Ê∂àÊÅØÊàêÂäüüéâ„ÄÇ"):400===t.error_code?Uo.info("ËØ∑‰∏ªÂä®ÁªôbotÂèëÈÄÅ‰∏ÄÊù°Ê∂àÊÅØÂπ∂Ê£ÄÊü•Êé•Êî∂Áî®Êà∑IDÊòØÂê¶Ê≠£Á°Æ„ÄÇ"):401===t.error_code&&Uo.info("Telegram bot token Â°´ÂÜôÈîôËØØ„ÄÇ")})).catch((t=>{Uo.info("telegramÂèëÈÄÅÈÄöÁü•Ê∂àÊÅØÂ§±Ë¥•ÔºÅÔºÅ"),Uo.info(t)})).finally((()=>{n("")}))}else n("")}))}function Tc(t,e){return new Promise((n=>{const{DD_BOT_TOKEN:r,DD_BOT_SECRET:i}=mc,o={url:`https://oapi.dingtalk.com/robot/send?access_token=${r}`,data:{msgtype:"text",text:{content:` ${t}\n\n${e}`}},headers:{"Content-Type":"application/json"},timeout:15e3};if(r){if(i){const t=require("crypto"),e=Date.now(),n=t.createHmac("sha256",i);n.update(`${e}\n${i}`);const r=encodeURIComponent(n.digest("base64"));o.url=`${o.url}&timestamp=${e}&sign=${r}`}lc.post(o).then((t=>{0===t.errcode?Uo.info("ÈíâÈíâÂèëÈÄÅÈÄöÁü•Ê∂àÊÅØÊàêÂäüüéâ„ÄÇ"):Uo.info(`ÈíâÈíâÂèëÈÄÅÈÄöÁü•Â§±Ë¥•Ôºö${t.errmsg}`)})).catch((t=>{Uo.info("ÈíâÈíâÂèëÈÄÅÈÄöÁü•Ê∂àÊÅØÂ§±Ë¥•ÔºÅÔºÅ"),Uo.info(t)})),n("")}else n("")}))}function Sc(t,e){return new Promise((n=>{const{QYWX_KEY:r}=mc,i={url:`https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=${r}`,data:{msgtype:"text",text:{content:` ${t}\n\n${e}`}},headers:{"Content-Type":"application/json"},timeout:15e3};r&&lc.post(i).then((t=>{0===t.errcode?Uo.info("‰ºÅ‰∏öÂæÆ‰ø°ÂèëÈÄÅÈÄöÁü•Ê∂àÊÅØÊàêÂäüüéâ„ÄÇ"):Uo.info(`‰ºÅ‰∏öÂæÆ‰ø°ÂèëÈÄÅÈÄöÁü•Â§±Ë¥•Ôºö${t.errmsg}`)})).catch((t=>{Uo.info("‰ºÅ‰∏öÂæÆ‰ø°ÂèëÈÄÅÈÄöÁü•Ê∂àÊÅØÂ§±Ë¥•ÔºÅÔºÅ"),Uo.info(t)})).finally((()=>{n("")})),n("")}))}function Ic(t){const{QYWX_AM:e}=mc,n=null==e?void 0:e.split(",");if(n[2]){const e=n[2].split("|");let r="";for(let n=0;n<e.length;n++){const i="Á≠æÂà∞Âè∑ "+(n+1);t.match(i)&&(r=e[n])}return r||(r=n[2]),r}return"@all"}function Oc(t,e){return new Promise((n=>{const r=mc.QYWX_AM;if(r){const i=r.split(","),o={url:"https://qyapi.weixin.qq.com/cgi-bin/gettoken",data:{corpid:`${i[0]}`,corpsecret:`${i[1]}`},headers:{"Content-Type":"application/json"},timeout:15e3};lc.post(o).then((r=>{const o=e.replace(/\n/g,"<br/>"),a=JSON.parse(r).access_token;let s;switch(i[4]){case"0":s={msgtype:"textcard",textcard:{title:`${t}`,description:`${e}`,url:"https://github.com/whyour/qinglong",btntxt:"Êõ¥Â§ö"}};break;case"1":s={msgtype:"text",text:{content:`${t}\n\n${e}`}};break;default:s={msgtype:"mpnews",mpnews:{articles:[{title:`${t}`,thumb_media_id:`${i[4]}`,author:"Êô∫ËÉΩÂä©Êâã",content_source_url:"",content:`${o}`,digest:`${e}`}]}}}i[4]||(s={msgtype:"text",text:{content:`${t}\n\n${e}`}}),s={url:`https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=${a}`,data:{touser:`${Ic(e)}`,agentid:`${i[3]}`,safe:"0",...s},headers:{"Content-Type":"application/json"}},lc.post(s).then((t=>{0===t.errcode?Uo.info("ÊàêÂëòID:"+Ic(e)+"‰ºÅ‰∏öÂæÆ‰ø°Â∫îÁî®Ê∂àÊÅØÂèëÈÄÅÈÄöÁü•Ê∂àÊÅØÊàêÂäüüéâ„ÄÇ"):Uo.info(`‰ºÅ‰∏öÂæÆ‰ø°Â∫îÁî®Ôºö${t.errmsg}`)})).catch((t=>{Uo.info("ÊàêÂëòID:"+Ic(e)+"‰ºÅ‰∏öÂæÆ‰ø°Â∫îÁî®Ê∂àÊÅØÂèëÈÄÅÈÄöÁü•Ê∂àÊÅØÂ§±Ë¥•ÔºÅÔºÅ"),Uo.info(t)})).finally((()=>{n("")}))})).catch((t=>{Uo.error("‰ºÅ‰∏öÂæÆ‰ø°Â∫îÁî®Ê∂àÊÅØÂèëÈÄÅÈÄöÁü•Ê∂àÊÅØÂ§±Ë¥•ÔºÅÔºÅ")}))}else n("")}))}function Ec(t,e,n={}){return new Promise((r=>{const{IGOT_PUSH_KEY:i}=mc;if(i){if(!new RegExp("^[a-zA-Z0-9]{24}$").test(i))return Uo.info("ÊÇ®ÊâÄÊèê‰æõÁöÑIGOT_PUSH_KEYÊó†Êïà"),void r("");const o={url:`https://push.hellyw.com/${i.toLowerCase()}`,params:`title=${t}&content=${e}&${Po(n)}`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};lc.post(o).then((t=>{"string"==typeof t&&(t=JSON.parse(t)),0===t.ret?Uo.info("iGotÂèëÈÄÅÈÄöÁü•Ê∂àÊÅØÊàêÂäüüéâ"):Uo.info(`iGotÂèëÈÄÅÈÄöÁü•Ê∂àÊÅØÂ§±Ë¥•Ôºö${t.errMsg}`)})).catch((t=>{Uo.info("ÂèëÈÄÅÈÄöÁü•Ë∞ÉÁî®APIÂ§±Ë¥•ÔºÅÔºÅ"),Uo.info(t)})).finally((()=>{r("")}))}else r("")}))}function Cc(t,e){return new Promise((n=>{const{PUSH_PLUS_TOKEN:r,PUSH_PLUS_USER:i}=mc;if(r){e=e.replace(/[\n\r]/g,"<br>");const o={url:"https://www.pushplus.plus/send",params:{token:`${r}`,title:`${t}`,content:`${e}`,topic:`${i}`},headers:{"Content-Type":" application/json"},timeout:15e3};lc.post(o).then((t=>{200===t.code?Uo.info(`push+ÂèëÈÄÅ${i?"‰∏ÄÂØπÂ§ö":"‰∏ÄÂØπ‰∏Ä"}ÈÄöÁü•Ê∂àÊÅØÂÆåÊàê„ÄÇ`):Uo.info(`push+ÂèëÈÄÅ${i?"‰∏ÄÂØπÂ§ö":"‰∏ÄÂØπ‰∏Ä"}ÈÄöÁü•Ê∂àÊÅØÂ§±Ë¥•Ôºö${t.msg}`)})).catch((t=>{Uo.info(`push+ÂèëÈÄÅ${i?"‰∏ÄÂØπÂ§ö":"‰∏ÄÂØπ‰∏Ä"}ÈÄöÁü•Ê∂àÊÅØÂ§±Ë¥•ÔºÅÔºÅ`),Uo.info(t)})).finally((()=>{n("")}))}else n("")}))}async function Pc(t,e){Uo.info("----„ÄêÊ∂àÊÅØÊé®ÈÄÅ„Äë----"),t=`Bili-${oa.nickname}-${t}`,await async function(t,e,n={},r="\n\nÊú¨ÈÄöÁü• ByÔºöhttps://github.com/catlair/BiliTools"){hc(),e+=r,await Promise.all([wc(t,e),Cc(t,e)]),await Promise.all([bc(t,e,n),$c(t,e),Tc(t,e),Sc(t,e),Oc(t,e),Ec(t,e,n),yc(t,e),_c(t,e),vc(t,e)])}(t,e,void 0,"")}const xc=fc({baseURL:nc,headers:{"user-agent":ia.USER_AGENT}}),kc=fc({baseURL:rc,headers:{Referer:ec,"user-agent":ia.USER_AGENT}}),Lc=fc({baseURL:ic,headers:{Referer:ec,"user-agent":ia.USER_AGENT}}),Nc=fc({baseURL:oc,headers:{"user-agent":ia.USER_AGENT}}),Rc=fc({baseURL:ac,headers:{"user-agent":ia.USER_AGENT}});function Ac(t=1,e=50,n=1){return kc.get(`/xlive/app-ucenter/v1/fansMedal/panel?page=${t}&page_size=${e}&target_id=${n}`)}function Uc(t=3394945){const e=(new Date).getTime();return kc.get(`/xlive/web-room/v1/gift/bag_list?t=${e}&room_id=${t}`)}function jc(t=1,e=10){return t>10&&(t=10),kc.get(`/xlive/app-ucenter/v1/user/GetMyMedals?page=${t}&page_size=${e}`)}function Bc({ruid:t,gift_num:e,bag_id:n,gift_id:r,roomid:i}){const o=ia.BILIJCT,a=o,s={gift_id:r,ruid:t,gift_num:e,bag_id:n,biz_id:i,rnd:(new Date).getTime(),send_ruid:0,storm_beat_id:0,metadata:"",price:0,visit_id:"",csrf:o,platform:"pc",biz_code:"Live",csrf_token:a,uid:ia.USERID};return kc.post("/xlive/revenue/v2/gift/sendBag",s,{headers:{Origin:Vs}})}function Dc(t){return kc.get(`/xlive/lottery-interface/v1/Anchor/Check?roomid=${t}`)}function Gc(){return Lc.get("/x/web-interface/nav",{headers:{Origin:Ws}})}function Mc(){return Lc.get("/x/web-interface/coin/today/exp")}function qc(t=1,e=50,n=-10){return Lc.get("/x/relation/tag",{params:{tagid:n,pn:t,ps:e}})}function Fc(t,e){return Lc.post("/x/relation/tags/addUsers?cross_domain=true",{fids:t,tagids:e,csrf:ia.BILIJCT},{headers:{Origin:Xs}})}function Kc(t){const e=t.level_info,n=e.current_level;if(n>=ia.BILI_TARGET_LEVEL&&(oa.coinsTask=0),Uo.info(`ÂΩìÂâçÁ≠âÁ∫ß: ${e.current_level}`),n>=6){const t=ia.function;t.shareAndWatch=!1,t.addCoins=!1,t.taskReward=!1,Uo.info("Â∑≤ÁªèÊª°Á∫ßÔºå‰∏çÈúÄË¶ÅÂÜçÊäïÂ∏Å‰∫ÜÔºåÂÅö‰∏™ÁôΩÂ´ñÊÄ™Âêß")}else{const t=e.next_exp-e.current_exp;Uo.info(`Ë∑ùÁ¶ªÂçáÁ∫ßËøòÈúÄË¶Å ${t} ÁªèÈ™åÔºåÈ¢ÑËÆ° ${function(t){if(ia.BILI_TARGET_COINS<=0)return t/15;const e=10*ia.BILI_TARGET_COINS+15,n=t/e,r=oa.money/(ia.BILI_TARGET_COINS-1);return n<r?Math.floor(n):(t-r*e)/25+r}(t).toFixed(2)} Â§©`)}}async function Hc(t){try{var e;const{data:n}=await xc.get("/site/getCoin");Uo.info(`ÁôªÂΩïÊàêÂäü: ${t.uname}`),Uo.info(`Á°¨Â∏Å‰ΩôÈ¢ù: ${n.money||0}`),oa.nickname=function(t){const e=t.length;return e<=3?t:`${t[0]}**${t[e-1]}`}(t.uname),oa.money=n.money||0,oa.userLevel=t.level_info.current_level,oa.bCoinCouponBalance=(null===(e=t.wallet)||void 0===e?void 0:e.coupon_balance)||0,Kc(t),function(t){let e="";switch(oa.vipType=t.vipType,t.vipType){case 0:e="Êó†Â§ß‰ºöÂëò";break;case 1:e="ÊúàÂ∫¶Â§ß‰ºöÂëò";break;case 2:e="Âπ¥Â∫¶Â§ß‰ºöÂëò"}0===t.vipStatus&&(e="Êó†Â§ß‰ºöÂëò"===e?e:e+"[Â∑≤ËøáÊúü]"),Uo.info(`Â§ß‰ºöÂëòÁä∂ÊÄÅ: ${e}`)}(t)}catch(t){Uo.error(`Ëé∑ÂèñÁ°¨Â∏Å‰ø°ÊÅØÂºÇÂ∏∏: ${t.message}`),Uo.debug(t)}}function Jc(t,e,n=1){return Lc.post("/x/web-interface/coin/add",{aid:t,multiply:e,selectLike:n,csrf:ia.BILIJCT})}function Yc(t,e=1){return dc.post("https://www.bilibili.com/audio/music-service-c/web/coin/add",{sid:t,multiply:e,csrf:ia.BILIJCT})}const zc="video",Qc="audio",Wc="article";async function Vc(t=!0){try{const e=ia.USERID,{data:n,message:r,code:i}=await(t?function(t=1,e=50){return qc(t,e,-10)}():function(t,e=1,n=50,r="desc",i="attention"){return Lc.get("/x/relation/followings",{params:{vmid:t,pn:e,ps:n,order:r,order_type:i}})}(e)),o=t?n:n.list;if(!o||0===o.length)return{msg:"-1",data:{}};if(0===i){await sa();const{mid:t}=xo(o)||{};return await tu(t)}return{msg:t?`Êú™Ëé∑ÂèñÂà∞ÁâπÂà´ÂÖ≥Ê≥®ÂàóË°®: ${i}-${r}`:`Êú™Ëé∑ÂèñÂà∞ÂÖ≥Ê≥®ÂàóË°®: ${i}-${r}`,data:{}}}catch(t){return{msg:t.message,data:{}}}}async function Xc(){const t=xo([1,3,4,5,160,22,119]);try{const{data:e,message:n,code:r}=await function(t=1,e=3){return Lc.get("/x/web-interface/ranking/region",{params:{rid:t,day:e}})}(t,3);if(0==r){const{aid:t,title:n,author:r}=xo(e);return{msg:"0",data:{id:Number(t),title:n,author:r}}}return{msg:`Êú™Ëé∑ÂèñÂà∞ÊéíË°å‰ø°ÊÅØ: ${r}-${n}`,data:{}}}catch(t){return{msg:t.message,data:{}}}}async function Zc(){const t=ia.BILI_CUSTOMIZE_UP;return 0===t.length?{msg:"-1",data:{}}:await tu(xo(t))}async function tu(t){try{const{code:e,data:n,message:r}=await function(t){return Lc.get(`/x/space/navnum?mid=${t}`)}(t);if(e)return{msg:`ÈÄöËøáuidËé∑ÂèñËßÜÈ¢ëÂ§±Ë¥•: ${e}-${r}`,data:{}};await sa();const{video:i,audio:o,article:a}=n,{type:s,page:c,index:u}=function([t,e,n]){const r=t+e+n;if(!r)return;const i=$o(0,r-1);let o=i;if(i<t)return{type:zc,page:vo(30,o+1),index:o%30};const a=t+e;return o=i-t,i<a?{type:Qc,page:vo(30,o+1),index:o%30}:(o=i-a,{type:Wc,page:vo(12,o+1),index:o%12})}([i,o,a]),f={[zc]:eu,[Qc]:nu,[Wc]:ru},l=await f[s](t,c,u);return l.message?{msg:l.message,data:{}}:{msg:"0",data:l}}catch(t){return Uo.debug(t),{msg:t.message,data:{}}}}async function eu(t,e,n){const{code:r,data:i,message:o}=await function(t,e=30,n=1,r=""){return Lc.get("/x/space/arc/search",{params:{jsonp:"jsonp",order:"pubdate",keyword:r,pn:n,tid:0,ps:e,mid:t}})}(t,30,e);if(r)return{message:o};const{aid:a,title:s,author:c}=i.list.vlist[n];return{type:zc,id:a,title:s,author:c}}async function nu(t,e,n){const{code:r,data:i,msg:o}=await function(t,e=30,n=1){return Lc.get("/audio/music-service/web/song/upper",{params:{jsonp:"jsonp",order:1,pn:n,ps:e,uid:t}})}(t,30,e);if(r)return{message:o};const{data:a}=i,{id:s,uname:c,title:u}=a[n];return{type:Qc,id:s,title:u,author:c}}async function ru(t,e,n){const{code:r,data:i,message:o}=await function(t,e=12,n=1){return Lc.get("/x/space/article",{params:{callback:"__test",jsonp:"jsonp",sort:"publish_time",pn:n,ps:e,mid:t},requestOptions:{isJsonp:!0}})}(t,12,e);if(r)return{message:o};const{articles:a}=i,{id:s,title:c,author:{name:u}}=a[n];return{type:Wc,id:s,title:c,author:u,mid:t}}const iu=function(){const t=[Zc,Vc,()=>Vc(!1),Xc];return ia.BILI_CUSTOMIZE_UP||t.shift(),t}();async function ou(t=0){iu.splice(0,oa.currentStartFun+t);for(let t=0;t<iu.length;t++){const e=iu[t];let n=Number(ia.BILI_COIN_RETRY_NUM??4);for(n=n<1?1:n>8?8:n;n--;){await sa();const t=await e();if("-1"===t.msg&&(n=0),"0"===t.msg)return t}n<=0&&(oa.currentStartFun=t)}return{msg:"-1",data:{id:0}}}async function au({id:t,coin:e=1,type:n="video",mid:r}){const i={[zc]:Jc,[Qc]:Yc,[Wc]:(t,e=1)=>function(t,e,n=1){return Lc.post("/x/web-interface/coin/add",{aid:e,upid:t,avtype:2,multiply:n,csrf:ia.BILIJCT})}(r,t,e)},o=await i[n](Number(t),e);return{code:o.code,message:o.message||o.msg}}async function su(t){if(await async function(){try{const{data:t,code:e}=await Mc();if(0==e){const e=ia.BILI_TARGET_COINS-t/10;oa.coinsTask=e>0?e:0}}catch(t){}}(),oa.coinsTask<=0||oa.money<=0)return!0;const{data:e,msg:n}=await ou(t.priority);return null!=e&&e.id&&"0"==n?(await sa(),await async function(t,e){const{id:n,title:r,author:i,type:o,mid:a}=t;try{const t=await au({id:n,type:o,mid:a});if(0===t.code)oa.money--,oa.coinsTask--,e.num++,Uo.info(`Áªô[${r}--up„Äê${i}„Äë]ÊäïÂ∏ÅÊàêÂäü`);else if(34005===t.code)e.fillCount++,Uo.verbose(`ÂΩìÂâçÁ®ø‰ª∂[${n}]‰∏çËÉΩÂÜçÊäïÂ∏Å‰∫Ü`),e.fillCount>=3&&(Uo.warn("Ëá™ÂÆö‰πâÁî®Êà∑ÁªÑÊäïÂ∏Å‰ºº‰πéÊ≤°ÊúâÂ∏ÅÂèØÊäï‰∫Ü"),e.priority++);else{if(-111===t.code||-104===t.code)return Uo.warn(`${n} ${t.message} Êó†Ê≥ïÁªßÁª≠ËøõË°åÊäïÂ∏Å`),!0;if(e.eCount++,Uo.warn(`Áªô${n}ÊäïÂ∏ÅÂ§±Ë¥• ${t.code} ${t.message}`),e.prevCode===t.code)return!0;e.prevCode=t.code}}catch(t){e.eCount++,Uo.error(`ÊäïÂ∏ÅÂºÇÂ∏∏ ${t.message}`)}finally{await sa(1500)}return!1}(e,t)):(t.eCount++,!1)}async function cu(){try{const{data:t,code:e,message:n}=await Rc.get("/link_group/v1/member/my_groups");return 0===e?(null==t?void 0:t.list)||[]:(Uo.warn(`Ëé∑ÂèñËá™Â∑±ÁöÑÂ∫îÊè¥Âõ¢ÂºÇÂ∏∏Â§±Ë¥•: ${n}`),[])}catch(t){Uo.error(`Ëé∑ÂèñËá™Â∑±ÁöÑÂ∫îÊè¥Âõ¢ÂºÇÂ∏∏: ${t}`)}}const uu=["(‚åí‚ñΩ‚åí)","ÔºàÔø£‚ñΩÔø£Ôºâ","(=„Éªœâ„Éª=)","(ÔΩÄ„Éªœâ„Éª¬¥)","(„ÄúÔø£‚ñ≥Ôø£)„Äú","(ÔΩ•‚àÄÔΩ•)","(¬∞‚àÄ¬∞)Ôæâ","(Ôø£3Ôø£)","‚ïÆ(Ôø£‚ñΩÔø£)‚ï≠","_(:3„Äç‚à†)_","( ¬¥_„ÇùÔΩÄ)","‚Üê_‚Üê","‚Üí_‚Üí","(<_<)","(>_>)","(;¬¨_¬¨)","(Ôæü–îÔæü‚â°Ôæü–¥Ôæü)!?","Œ£(Ôæü–¥Ôæü;)","Œ£( Ôø£‚ñ°Ôø£||)","(¬¥ÔºõœâÔºõ`)","Ôºà/T–îT)/","(^„Éªœâ„Éª^ )","(ÔΩ°ÔΩ•œâÔΩ•ÔΩ°)","(‚óèÔø£(ÔΩ¥)Ôø£‚óè)","Œµ=Œµ=(„Éé‚âß‚àá‚â¶)„Éé","(¬¥ÔΩ•_ÔΩ•`)","(-_-#)","ÔºàÔø£„Å∏Ôø£Ôºâ","(Ôø£Œµ(#Ôø£) Œ£","„ÉΩ(`–î¬¥)Ôæâ","Ôºà#-_-)‚îØ‚îÅ‚îØ","(‚ïØ¬∞Âè£¬∞)‚ïØ(‚î¥‚Äî‚î¥","‚Üê‚ó°‚Üê","( ‚ô•–¥‚ô•)","Œ£>‚Äï(„ÄÉ¬∞œâ¬∞„ÄÉ)‚ô°‚Üí","‚ÅÑ(‚ÅÑ ‚ÅÑ‚Ä¢‚ÅÑœâ‚ÅÑ‚Ä¢‚ÅÑ ‚ÅÑ)‚ÅÑ","(‚ï¨Ôæü–¥Ôæü)‚ñÑÔ∏ª‚îª‚î≥‚ïê‰∏Ä","ÔΩ•*ÔΩ•:‚â°(„ÄÄŒµ:)","(Ê±ó)","(Ëã¶Á¨ë)"].concat("1","2","3","4","5","6","7","8","9","Á≠æÂà∞","ÂìàÂìà"),fu=new Ao({console:"debug",file:"debug"},"live");async function lu(){let t=99,e=0;const n=[];try{for(;e<t;){const{code:r,message:i,data:o}=await Ac(e+1,50,ia.USERID);if(0!==r)return Uo.verbose(`Ëé∑ÂèñÂããÁ´†‰ø°ÊÅØÂ§±Ë¥• ${r} ${i}`),null;if(!o)return n;t=o.page_info.total_page,e=o.page_info.current_page,n.push(...o.list,...o.special_list)}return n}catch(t){return Uo.error(`Ëé∑ÂèñÂããÁ´†ÂºÇÂ∏∏ ${t.message}`),null}}function du({room_info:t,medal:e}){if(null==t||!t.room_id)return!1;if(e.level>=20)return!1;if(e.today_feed>=e.day_limit)return!1;const{whiteList:n,blackList:r}=ia.intimacy;return n&&n.length?!!n.includes(t.room_id):!r||!r.includes(t.room_id)}async function pu(t,e){const n=uu[$o(uu.length-1)];try{const{code:r,message:i}=await function(t,e){const n=ia.BILIJCT,r=n;return e||(e=$o(10).toString()),kc.post("/msg/send",{color:5566168,fontsize:25,mode:1,msg:e,rnd:Date.now(),roomid:t,bubble:0,csrf:n,csrf_token:r})}(t,n);return 0===r||(11e3===r?(Uo.warn(`„Äê${e}„Äë${t}-ÂèØËÉΩÊú™ÂºÄÂêØËØÑËÆ∫`),!1):(Uo.warn(`„Äê${e}„Äë${t}-ÂèëÈÄÅÂ§±Ë¥• ${i}`),Uo.verbose(`code: ${r}`),!1))}catch(t){Uo.verbose(`ÂèëÈÄÅÂºπÂπïÂºÇÂ∏∏ ${t.message}`)}}async function gu(t){try{const{code:n,message:r,data:i}=await(e=t,kc.post("xlive/web-room/v1/index/TrigerInteract",{roomid:e,interact_type:3,csrf:ia.BILIJCT,csrf_token:ia.BILIJCT,visit_id:""}));if(0===n)return i;Uo.info(`„Äê${t}„ÄëÁõ¥Êí≠Èó¥ÂàÜ‰∫´Â§±Ë¥• ${n} ${r}`)}catch(e){Uo.warn(`ÂàÜ‰∫´Áõ¥Êí≠Èó¥ [${t}] ÂºÇÂ∏∏ ${e.message}`)}var e}async function mu(t){try{const{code:n,message:r,data:i}=await(e=t,kc.post("xlive/web-ucenter/v1/interact/likeInteract",{roomid:e,csrf:ia.BILIJCT,csrf_token:ia.BILIJCT}));if(0===n)return i;Uo.info(`„Äê${t}„ÄëÁõ¥Êí≠Èó¥ÁÇπËµûÂ§±Ë¥• ${n} ${r}`)}catch(t){Uo.warn(`ÁÇπËµûÁõ¥Êí≠Èó¥ÂºÇÂ∏∏ ${t.message}`)}var e}async function hu(){const t=(e=await lu())&&0!==e.length?e.filter(du):[];var e;for(let e=0;e<t.length;e++){const n=t[e];await yu(n)}}async function yu(t){const{room_info:e,anchor_info:n}=t;if(!e||!n)return;const{liveLike:r,liveSendMessage:i,liveShare:o}=ia.intimacy,a=n.nick_name,s=e.room_id;i&&(fu.verbose(`„Äê${a}„ÄëÂºÄÂßãÂèëÈÄÅÁõ¥Êí≠ÂºπÂπï`),await pu(s,a)),o&&async function(){await sa(100,300);for(let t=0;t<5;t++)fu.verbose(`ÂàÜ‰∫´ [${a}] Áõ¥Êí≠Èó¥`),await gu(s),await sa(4e3)}().catch((t=>Uo.error(t))),r&&async function(){await sa(100,300);for(let t=0;t<3;t++)fu.verbose(`Áªô [${a}] Áõ¥Êí≠Èó¥ÁÇπËµû`),await mu(s),await sa(6500)}().catch((t=>Uo.error(t))),await sa(22e3)}async function _u(){try{const{data:t,message:e,code:n}=await Gc();if(0!==n)return void Uo.warn(`Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØÂ§±Ë¥•Ôºö${n} ${e}`);!function(t){var e;oa.bCoinCouponBalance=(null===(e=t.wallet)||void 0===e?void 0:e.coupon_balance)||0}(t)}catch(t){Uo.error(`Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØÂºÇÂ∏∏Ôºö${t.message}`)}}var wu;function vu(){const t=wo(),e=t.getDate(),n=function(t){const e=t||wo(),n=e.getFullYear(),r=e.getMonth()+1;return 2===r?n%4==0&&n%100!=0||n%400==0?29:28:[4,6,9,11].includes(r)?30:31}(t),r=ia.CHARGE_PRESET_TIME;return oa.bCoinCouponBalance<2?(Uo.info(`Ââ©‰ΩôÂà∏‰∏∫${oa.bCoinCouponBalance}Ôºå‰∏çË∂≥2Ë∑≥ËøáÂÖÖÁîµ`),!1):n===e?(Uo.info("‰ªäÂ§©ÊòØÊúÄÂêé‰∏ÄÂ§©‰∫Ü"),!0):!(r>e)||(Uo.info(`È¢ÑËÆæÊó∂Èó¥‰∏∫${r}Ôºå‰∏çÁ¨¶ÂêàÊù°‰ª∂`),!1)}async function bu(){try{const{data:t,code:e,message:n}=await Lc.get("/x/vip/privilege/my",{headers:{origin:Ws,referer:ec}});if(0!==e)return void Uo.info(`Ëé∑ÂèñÈ¢ÜÂèñÁä∂ÊÄÅÂ§±Ë¥•Ôºö${e} ${n}`);const{list:r}=t;return r.slice(0,2).filter((t=>{const e=parseInt(((new Date).getTime()/1e3).toString());return 0===t.state&&e>t.period_end_unix}))}catch(t){Uo.error(`Ëé∑ÂèñÈ¢ÜÂèñÁä∂ÊÄÅÂá∫Áé∞ÂºÇÂ∏∏Ôºö${t.message}`)}}async function $u(t){try{const e=function(t){switch(t){case 1:return"B Â∏ÅÂà∏";case 2:return"Â§ß‰ºöÂëò‰ºòÊÉ†Âà∏";default:return""}}(t),{code:n,message:r}=await function(t=1){return Lc.post("/x/vip/privilege/receive",{csrf:ia.BILIJCT,type:t},{headers:{origin:tc,referer:ec}})}(t);let i="ÊàêÂäü";return 0===n&&(i=`Â§±Ë¥• ${r}`),Uo.info(`È¢ÜÂèñ${e} ${i}`),!0}catch(t){Uo.error(`È¢ÜÂèñÊùÉÁõäÂá∫Áé∞ÂºÇÂ∏∏Ôºö${t.message}`)}return!1}async function Tu(t){let e=0,n=!1;for(;!(n||(n=await $u(t),e>2));)e++;return n}!function(t){t[t["ÊàêÂäü"]=4]="ÊàêÂäü",t[t["‰Ωé‰∫é20ÁîµÊ±†"]=-2]="‰Ωé‰∫é20ÁîµÊ±†",t[t["BÂ∏Å‰∏çË∂≥"]=-4]="BÂ∏Å‰∏çË∂≥"}(wu||(wu={}));let Su=0;async function Iu(){try{const{data:{list:t}}=await Uc();return t.filter((t=>{if(t.expire_at<=0)return!1;const e=(1e3*t.expire_at-(new Date).getTime())/864e5<2,n=![1,30607].includes(t.gift_id);return n&&e&&Uo.info(`${t.gift_name} Âç≥Â∞ÜËøáÊúüËØ∑Â∞ΩÂø´ÊäïÂñÇ`),!n&&e}))}catch(t){if(Su)return null;await Iu(),Su++}}async function Ou(t){try{const{data:{live_room:e,name:n}}=await function(t){return Lc.get(`/x/space/acc/info?mid=${t}&jsonp=jsonp`)}(t);if(await sa(),e.roomStatus)return{roomid:e.roomid,name:n}}catch{}}function Eu(t,e,n,r){const i=ia.BILIJCT,o={is_fav:0,main_id:e,oid:t,detail_id:n,count:r,csrf:i,csrf_token:i};return Lc.post("/x/esports/guess/add",o)}function Cu(){return oa.money-ia.MATCH_COINS<ia.BILI_TARGET_COINS&&(Uo.info(`ÈúÄË¶Å‰øùÁïô${ia.BILI_TARGET_COINS}‰∏™Á°¨Â∏ÅÔºå‰ªªÂä°ÁªìÊùü`),!0)}async function Pu(){const{data:t,code:e}=await qc(1,1,0);if(0!==e)throw new Error(`Ëé∑ÂèñÊúÄÂêé‰∏Ä‰∏™ÂÖ≥Ê≥®Â§±Ë¥•: ${e}`);return t[0]}async function xu(t){const{data:e,code:n}=await Lc.get("/x/relation/tags?jsonp=jsonp&callback=__jp3",{headers:{Referer:"https://space.bilibili.com/1/fans/follow?tagid=0"},requestOptions:{isJsonp:!0}});if(0===n)return e.find((e=>e.name===t));Uo.warn(`Ëé∑ÂèñÂàÜÁªÑÂàóË°®Â§±Ë¥•: ${n}`)}async function ku(t){const e=await xu(t);if(e)return e.tagid;await sa(300);const{data:n,code:r,message:i}=await(o=t,Lc.post("/x/relation/tag/create",{tag:o,jsonp:"jsonp",csrf:ia.BILIJCT}));var o;if(22106===r){await sa(300);const e=await xu(t);return e&&e.tagid}return 0!==r&&Uo.warn(`ÂàõÂª∫ÂàÜÁªÑÂ§±Ë¥•: ${r}-${i}`),n.tagid}async function Lu(t,e="Â§©ÈÄâÊó∂Âàª"){if(0===t.length)return;const n=await ku(e);if(n)for(const e of t){const{code:t,message:r}=await Fc(e.mid,n);0!==t&&Uo.warn(`ÁßªÂä®„Äê${e.uname}„ÄëÂ§±Ë¥•: ${t}-${r}`),await sa()}}async function Nu(t,e,n,r=1){if(t.length>e.length)return;const{data:i,code:o,message:a}=await qc(r,20,0);if(0===o){for(const{mid:r,uname:o}of i){if(t.length>=e.length)return;if(r===n)return;(e.includes(r)||e.includes(o))&&t.push({mid:r,uname:o})}if(!(i.length<20))return await Nu(t,e,n,r+1)}else Uo.warn(`Ëé∑ÂèñÂÖ≥Ê≥®Áî®Êà∑Â§±Ë¥•: ${o}-${a}`)}const Ru=0,Au=1,Uu=5,ju=1,Bu=504,Du=1096;let Gu;async function Mu(){try{const{data:t,code:e,message:n}=await kc.get("/xlive/web-interface/v1/index/getWebAreaList?source_id=2");return 0!==e&&Uo.info(`Ëé∑ÂèñÁõ¥Êí≠ÂàÜÂå∫Â§±Ë¥•: ${e}-${n}`),t.data.map((t=>t.list)).map((t=>t.map((t=>({areaId:t.id,parentId:t.parent_id})))))}catch(t){throw Uo.error(`Ëé∑ÂèñÁõ¥Êí≠ÂàÜÂå∫ÂºÇÂ∏∏: ${t.message}`),t}}async function qu(t,e,n=1,r="lottery"){try{await sa(100);const{data:i,code:o,message:a}=await function(t,e,n=1){return kc.get(`/xlive/web-interface/v1/second/getList?platform=web&parent_area_id=${t}&area_id=${e}&page=${n}`)}(e,t,n);return 0!==o&&Uo.info(`Ëé∑ÂèñÁõ¥Êí≠Èó¥ÂàóË°®Â§±Ë¥•: ${o}-${a}`),function(t){const e=[],n=[];return t.forEach((t=>{const r=t.pendant_info[2];r&&(r.pendent_id===Bu?e.push(t):r.pendent_id===Du&&n.push(t))})),{lotteryTime:e,lotteryPacket:n}}(i.list)["lottery"===r?"lotteryTime":"lotteryPacket"]}catch(t){throw Uo.error(`Ëé∑ÂèñÁõ¥Êí≠Èó¥ÂàóË°®ÂºÇÂ∏∏: ${t.message}`),t}}async function Fu(t,e,n=1){const r=await qu(t,e,n),i=[];for(const t of r){const e=await Ku(t);e&&(i.push({...e,uid:t.uid,uname:t.uname}),await sa(100))}return i}async function Ku(t){const{blackUid:e}=ia.lottery;if(e.includes(t.uid))return void Uo.info(`Ë∑≥ËøáÈªëÂêçÂçïÁî®Êà∑: ${t.uname}`);let n,r,i;try{({data:r,code:n,message:i}=await Dc(t.roomid))}catch(e){return void Uo.info(`Áõ¥Êí≠Èó¥${t.roomid}Ê£ÄÊµãÂºÇÂ∏∏: ${e.message}`)}if(0!==n)return void Uo.debug(`Áõ¥Êí≠Èó¥${t.roomid}Ê£ÄÊµãÂ§±Ë¥•: ${n}-${i}`);if(null===r)return;const{excludeAward:o,includeAward:a}=ia.lottery,s=o.some((t=>r.award_name.match(t)));if(a.some((t=>r.award_name.match(t)))||!s){if(r.status===ju&&!(r.gift_price>0))return 4===r.require_type&&(Uo.info("ÊÇ®ËÉΩÂèçÈ¶àÁªô‰ΩúËÄÖËæìÂá∫‰∫Ü‰ªÄ‰πàÂêóÔºü"),Uo.info(`${r.require_type}--${r.require_text}--${r.require_value}`),Uo.info("‰πüËÆ∏ËøôÊ≠£ÊòØÊàë‰ª¨ÊÉ≥Ë¶ÅÁöÑ„ÄÇ")),r.require_type===Uu&&oa.userLevel>=r.require_value||r.require_type===Ru?r:r.require_type!==Au||ia.lottery.skipNeedFollow?void 0:r}else Uo.info(`Ë∑≥ËøáÂ±èËîΩÂ•ñÂìÅ: ${r.award_name}`)}async function Hu(t,e=!0){try{const{id:r,gift_id:i,gift_num:o,award_name:a,uid:s,uname:c,require_type:u,require_text:f}=t;Uo.info(`Â§©ÈÄâ‰∏ªÊí≠Ôºö„Äê${c}„Äë`),Uo.info(`Â•ñÂìÅÔºö${a}`);const{code:l,message:d}=await(n={id:r,gift_id:i,gift_num:o},kc.post("/xlive/lottery-interface/v1/Anchor/Join",{...n,csrf:ia.BILIJCT,csrf_token:ia.BILIJCT,visit_id:Io(),platform:"pc"}));if(0!==l)return void Uo.info(`Â§©ÈÄâÂ§±Ë¥•: ${l}-${d}`);if(Uo.info("Â§©ÈÄâÊàêÂäü ‚àö"),u===Au&&e){Oo(Gu,s);(function(t){const e=(t=t.replace("ÂÖ≥Ê≥®‰∏ªÊí≠","")).split(/\s*\+\s*/);return e.shift(),e})(f).forEach((t=>Oo(Gu,t)))}}catch(t){Uo.info(`Â§©ÈÄâÂºÇÂ∏∏: ${t.message}`)}var n}async function Ju(t,e,n=2){for(let r=1;r<=n;r++){const n=await Fu(t,e,r);for(const t of n)await Hu(t),await sa(300)}}async function Yu(t){try{const{data:e,code:n}=await function(t){return kc.get(`/xlive/lottery-interface/v1/lottery/getLotteryInfoWeb?roomid=${t}`)}(t);if(0!==n)return;const{popularity_red_pocket:r}=e;if(!r)return;const{lot_id:i,lot_status:o}=r[0];if(2===o)return;return i}catch(t){}}async function zu(t,e,n=1){const r=await qu(t,e,n,"redPack"),i=[];for(const t of r){const e=await Yu(t.roomid);e&&(i.push({uid:t.uid,uname:t.uname,lot_id:e,room_id:t.roomid}),await sa(100))}return i}async function Qu(t){try{const{lot_id:n,uid:r,uname:i,room_id:o}=t;Uo.info(`Á∫¢ÂåÖ‰∏ªÊí≠Ôºö„Äê${i}„Äë`);const{code:a,message:s}=await(e={room_id:o,lot_id:n,ruid:r},kc.post("/xlive/lottery-interface/v1/popularityRedPocket/RedPocketDraw",{...e,spm_id:"444.8.red_envelope.extract",jump_from:"",session_id:"",csrf_token:ia.BILIJCT,csrf:ia.BILIJCT,visit_id:""}));if(0!==a)return void Uo.info(`Á∫¢ÂåÖÂ§±Ë¥•: ${a}-${s}`);Gu.push(r),Uo.info("Á∫¢ÂåÖÊàêÂäü ‚àö")}catch(t){Uo.info(`Á∫¢ÂåÖÂºÇÂ∏∏: ${t.message}`)}var e}async function Wu(t,e,n=2){for(let r=1;r<=n;r++){const n=await zu(t,e,r);for(const t of n)await Qu(t),await sa(200)}}async function Vu(){const t=[];return await async function e(n=1){try{var r;const{data:i,code:o,message:a}=await function(t=1,e=9){return kc.get(`/xlive/web-ucenter/user/following?page=${t}&page_size=${e}`)}(n,9);if(0!==o)return void Uo.info(`Ëé∑ÂèñÂÖ≥Ê≥®Áõ¥Êí≠Èó¥Â§±Ë¥•: ${o}-${a}`);const s=null===(r=i.list)||void 0===r?void 0:r.filter((t=>1===t.live_status));if(9===s.length&&n<i.totalPage)return t.push(...s),e(n+1);t.push(...s)}catch(t){Uo.error(`Ëé∑ÂèñÂÖ≥Ê≥®Áõ¥Êí≠Èó¥ÂºÇÂ∏∏: ${t.message}`)}}(),t}async function Xu(t){try{const{code:e,message:n,data:r}=await Dc(t.roomid);if(0!==e)return void Uo.debug(`Áõ¥Êí≠Èó¥${t.roomid}Ê£ÄÊµãÂ§±Ë¥•: ${e}-${n}`);if(null===r)return;if(r.status!==ju)return;if(r.gift_price>0)return;return r}catch(e){return void Uo.info(`Áõ¥Êí≠Èó¥${t.roomid}Ê£ÄÊµãÂºÇÂ∏∏: ${e.message}`)}}async function Zu(){const{scanFollow:t}=ia.lottery;if(!t)return!0;try{Uo.info("ÂºÄÂßãÊâ´ÊèèÂÖ≥Ê≥®ÁöÑ‰∏ªÊí≠");const t=await async function(){const t=await Vu(),e=[];for(const n of t){const t=await Xu(n);t&&e.push({...t,uid:n.uid,uname:n.uname}),await sa(100)}return e}();for(const e of t)await Hu(e,!1),await sa(300);Uo.info("ÂÖ≥Ê≥®ÁöÑ‰∏ªÊí≠Â§©ÈÄâÂÆåÊàê")}catch(t){Uo.error(`ÂÖ≥Ê≥®ÁöÑ‰∏ªÊí≠Â§©ÈÄâÂºÇÂ∏∏: ${t.message}`)}return"only"!==t}async function tf(t){try{const{code:e,message:n,data:r}=await function({session_type:t}={session_type:1}){return Rc.get(`/session_svr/v1/session_svr/get_sessions?session_type=${t}&group_fold=1&unfollow_fold=1&sort_rule=2&build=0&mobi_app=web`)}();if(0!==e)return void Uo.warn(`Ëé∑Âèñ‰ºöËØùÂ§±Ë¥•Ôºö${e}-${n}`);const{session_list:i}=r;if(i.length<=0)return;return i.filter((({unread_count:e,talker_id:n,is_follow:r,last_msg:i})=>{return t.find((t=>t.mid===n))&&e>0&&n===i.sender_uid&&1===r&&(o=i.timestamp,Date.now()-1e3*o<36e5);var o}))}catch(t){Uo.error(`Ëé∑Âèñ‰ºöËØùÂºÇÂ∏∏Ôºö${t.message}`)}}async function ef(t){const e=await tf(t);await sa(200);try{for(let t=0;t<e.length;t++){const n=e[t];await nf(n)}}catch(t){Uo.error(`Êõ¥Êñ∞‰ºöËØùÂºÇÂ∏∏Ôºö${t.message}`)}e.length>=19&&await ef(t)}async function nf(t){switch(ia.lottery.actFollowMsg){case"del":case"delete":await function({talker_id:t,session_type:e}){return Rc.post("/session_svr/v1/session_svr/remove_session",{talker_id:t,session_type:e,build:0,mobi_app:"web",csrf_token:ia.BILIJCT,csrf:ia.BILIJCT})}(t);break;case"read":await function({talker_id:t,session_type:e,ack_seqno:n}){return Rc.post("/session_svr/v1/session_svr/update_ack",{talker_id:t,session_type:e,ack_seqno:n,build:0,mobi_app:"web",csrf_token:ia.BILIJCT,csrf:ia.BILIJCT},{headers:{origin:Zs}})}(t)}await sa(50)}var rf={taskReward:async function(){Uo.info("----„ÄêÊØèÊó•‰ªªÂä°ÂÆåÊàêÊÉÖÂÜµ„Äë----");try{const{data:t,message:e,code:n}=await Lc.get("/x/member/web/exp/reward");await sa();const{data:r}=await Mc();if(0!=n)return void Uo.warn(`Áä∂ÊÄÅËé∑ÂèñÂ§±Ë¥•: ${n} ${e}`);const i=oa.money-ia.BILI_STAY_COINS;let o=0;0===oa.coinsTask?Uo.info(`‰ªäÊó•ÊäïÂ∏ÅËé∑ÂèñÁªèÈ™å: ${r}ÔºåËøòÈúÄÊäïÂ∏Å0È¢óÔºåÁªèÈ™åÂ§ü‰∫ÜÔºå‰∏çÊÉ≥Êäï‰∫Ü`):i<=0?Uo.info(`‰ªäÊó•ÊäïÂ∏ÅËé∑ÂèñÁªèÈ™å: ${r}ÔºåËøòÈúÄÊäïÂ∏Å0È¢óÔºåÁ°¨Â∏Å‰∏çÂ§ü‰∫ÜÔºå‰∏çÊäïÂ∏Å‰∫Ü`):i<oa.coinsTask?(o=oa.coinsTask-i,Uo.info(`ÊäïÂ∏ÅËé∑ÂèñÁªèÈ™å: ${r}ÔºåËøòÈúÄÊäïÂ∏ÅÊï∞Èáè: ${o}È¢ó;(ÁõÆÊ†á${oa.coinsTask}È¢óÔºåÂøΩÁï•ÈÉ®ÂàÜÊäïÂ∏Å)`)):(o=oa.coinsTask-r/10,Uo.info(`ÊäïÂ∏ÅËé∑ÂèñÁªèÈ™å: ${r}ÔºåËøòÈúÄÊäïÂ∏ÅÊï∞Èáè: ${o}È¢ó;(ÁõÆÊ†á${oa.coinsTask}È¢ó)`)),oa.coinsTask=o,Uo.info("ÊØèÊó•ÂàÜ‰∫´: "+(t.share?"Â∑≤ÂÆåÊàê":"[Êú™ÂÆåÊàê]")),Uo.info("ÊØèÊó•Êí≠Êîæ: "+(t.watch?"Â∑≤ÂÆåÊàê":"[Êú™ÂÆåÊàê]")),oa.share=t.share,oa.watch=t.watch}catch(t){Uo.error(`Áä∂ÊÄÅËé∑ÂèñÂºÇÂ∏∏ ${t.message}`)}},liveSignTask:async function(){Uo.info("----„ÄêÁõ¥Êí≠Á≠æÂà∞„Äë----");try{const{data:t}=await kc.get("/xlive/web-ucenter/v1/sign/WebGetSignInfo");if(1===t.status)return Uo.info("Â∑≤Á≠æÂà∞ÔºåË∑≥ËøáÁ≠æÂà∞"),void Uo.info(`Â∑≤ÁªèÁ≠æÂà∞${t.hadSignDays}Â§©Ôºå${t.specialText}`)}catch(t){}try{const{code:t,data:e,message:n}=await kc.get("/xlive/web-ucenter/v1/sign/DoSign");0===t?Uo.info(`Áõ¥Êí≠Á≠æÂà∞ÊàêÂäü: ${e.text}ÔºåÁâπÂà´‰ø°ÊÅØ: ${e.specialText}ÔºåÊú¨ÊúàÁ≠æÂà∞Â§©Êï∞: ${e.hadSignDays}Â§©;`):Uo.warn(`Áõ¥Êí≠Á≠æÂà∞Â§±Ë¥•: ${t} ${n}`)}catch(t){Uo.error(`Áõ¥Êí≠Á≠æÂà∞ÂºÇÂ∏∏: ${t.message}`)}},shareAndWatch:async function(){if(Uo.info("----„ÄêÂàÜ‰∫´/Êí≠ÊîæËßÜÈ¢ë„Äë----"),oa.share&&oa.watch)return void Uo.info("Â∑≤ÂÆåÊàêÔºåË∑≥ËøáÂàÜ‰∫´/Êí≠Êîæ");let t=0;try{let e=await ou();if("-1"===e.msg&&(e=await Xc()),"0"!==e.msg)return Uo.warn(`Ëé∑ÂèñËßÜÈ¢ëÂ§±Ë¥• ${e.msg}`),!1;{const{id:n,author:r,title:i}=e.data;t=n,Uo.info(`Ëé∑ÂèñËßÜÈ¢ë: ${i} --up„Äê${r}„Äë`)}}catch(t){return Uo.error(`Ëé∑ÂèñËßÜÈ¢ëÂá∫Áé∞ÂºÇÂ∏∏: ${t.message}`),!1}if(!oa.share){await sa();try{const{code:e,message:n}=await function(t){const e={csrf:ia.BILIJCT,aid:t};return Lc.post("/x/web-interface/share/add",e)}(t);0===e?Uo.info("ÂàÜ‰∫´ËßÜÈ¢ëÊàêÂäü!"):Uo.warn(`ÂàÜ‰∫´ËßÜÈ¢ëÂ§±Ë¥•: ${e} ${n}`)}catch(t){Uo.error(`ÂàÜ‰∫´ËßÜÈ¢ëÂºÇÂ∏∏: ${t.message}`)}}if(!oa.watch){await sa();try{const{code:r,message:i}=await(e=t,n=$o(4,60),Lc.post("/x/click-interface/web/heartbeat",{aid:e,played_time:n}));0===r?Uo.info("Êí≠ÊîæËßÜÈ¢ëÊàêÂäü!"):Uo.warn(`Êí≠ÊîæËßÜÈ¢ëÂ§±Ë¥•: ${r} ${i}`)}catch(t){Uo.error(`Êí≠ÊîæËßÜÈ¢ëÂºÇÂ∏∏: ${t.message}`)}}var e,n},silver2Coin:async function(){Uo.info("----„ÄêÈì∂ÁìúÂ≠êÂÖëÊç¢Á°¨Â∏Å„Äë----");try{const{data:t,code:e,message:n}=await kc.get("/xlive/revenue/v1/wallet/getStatus");if(0!=e&&Uo.info(`Ëé∑ÂèñÁìúÂ≠êËØ¶ÊÉÖÂ§±Ë¥• ${n}`),0===t.silver_2_coin_left)Uo.info("‰ªäÊó•Â∑≤ÂÖëÊç¢‰∏ÄÊ¨°");else if(t.silver<700)Uo.info("ÂÖëÊç¢Â§±Ë¥•Ôºå‰Ω†ÁìúÂ≠ê‰∏çÂ§ü‰∫Ü");else{const{message:t}=await kc.post("/xlive/revenue/v1/wallet/silver2coin",{csrf_token:ia.BILIJCT,csrf:ia.BILIJCT});Uo.info(`ÂÖëÊç¢Á°¨Â∏ÅÔºö ${t}`),await kc.get("/xlive/revenue/v1/wallet/myWallet?need_bp=1&need_metal=1&platform=pc")}}catch(t){Uo.error(`Êìç‰ΩúÂºÇÂ∏∏ ${t.message}`)}},addCoins:async function(){if(Uo.info("----„ÄêËßÜÈ¢ëÊäïÂ∏Å„Äë----"),!oa.coinsTask)return void Uo.info("Ë∑≥ËøáÊäïÂ∏ÅÔºå‰ªäÊó•Â∑≤ÂÆåÊàê");const t={eCount:0,num:0,prevCode:0,fillCount:0,priority:0};let e=!1;for(;oa.coinsTask&&!e&&t.eCount<5;)e=await su(t);t.eCount>=5&&Uo.info("Âá∫Áé∞ÂºÇÂ∏∏/ÈîôËØØ5Ê¨°ÔºåËá™Âä®ÈÄÄÂá∫ÊäïÂ∏Å"),Uo.info(`‰∏ÄÂÖ±ÊàêÂäüÊäïÂ∏Å${t.num}È¢ó`),Uo.info(`Á°¨Â∏ÅËøòÂâ©${oa.money}È¢ó`)},mangaSign:async function(){Uo.info("----„ÄêÊº´ÁîªÁ≠æÂà∞„Äë----");try{const{code:t}=await function(t="android"){return Nc.post("/twirp/activity.v1.Activity/ClockIn",{platform:t})}();0==t?Uo.info("Êº´ÁîªÁ≠æÂà∞ÊàêÂäü"):Uo.warn("Êº´ÁîªÁ≠æÂà∞Â§±Ë¥•")}catch(t){const{status:e,statusCode:n}=t.response||{};400===e||400===n?Uo.info("Â∑≤ÁªèÁ≠æÂà∞Ëøá‰∫ÜÔºåË∑≥Ëøá‰ªªÂä°"):Uo.error(`Êº´ÁîªÁ≠æÂà∞ÂºÇÂ∏∏ ${t.message}`)}},supGroupSign:async function(){Uo.info("----„ÄêÂ∫îÊè¥Âõ¢Á≠æÂà∞„Äë----");const t=await cu();await sa();let e=0;for(let i=0;i<t.length;){const o=t[i];try{const{data:t,code:i,message:a}=await(n=o.group_id,r=o.owner_uid,Rc.get("/link_setting/v1/link_setting/sign_in",{params:{group_id:n,owner_id:r}}));0===i?0===t.status?e++:Uo.info(a):Uo.warn(`[${o.group_name}]Á≠æÂà∞Â§±Ë¥• ${a}`)}catch(t){Uo.error(`Á≠æÂà∞ÂºÇÂ∏∏ ${t.message}`)}finally{await sa()}}var n,r;Uo.info(`Á≠æÂà∞ÁªìÊùüÔºåÊàêÂäü${e}/${t.length}`)},liveSendMessage:async function(){Uo.info("----„ÄêÂèëÈÄÅÁõ¥Êí≠ÂºπÂπï„Äë----"),Uo.info("ËØ•ÂáΩÊï∞Âç≥Â∞ÜÂ∫üÂºÉÔºåËØ∑‰ΩøÁî® liveIntimacy Êõø‰ª£");try{const t=await lu(),e=t.length;let n=0,r=0;Uo.info(`‰∏ÄÂÖ±ÈúÄË¶ÅÂèëÈÄÅ${e}‰∏™Áõ¥Êí≠Èó¥`),Uo.verbose("ÊâÄÈúÄÊó∂Èó¥ÂèØËÉΩÂæàÈïøÔºåËØ∑ËÄêÂøÉÁ≠âÂæÖ");for(let i=0;i<e;i++){const{room_info:o,anchor_info:a,medal:s}=t[i];null!=o&&o.room_id?100===s.today_feed||s.level>=20?r++:(await pu(o.room_id,a.nick_name)&&n++,i<e-1&&await sa($o(1e4,25e3))):(Uo.info(`„Äê${a.nick_name}„ÄëÊ≤°ÊúâÁõ¥Êí≠Èó¥Âì¶`),r++)}Uo.info(`ÊàêÂäüÂèëÈÄÅ${n}‰∏™ÂºπÂπïÔºåË∑≥Ëøá${r}‰∏™`)}catch(t){Uo.error(`Áõ¥Êí≠Èó¥ÂèëÈÄÅÂºπÂπïÂºÇÂ∏∏: ${t.message}`)}},charging:async function(){if(Uo.info("----„ÄêÁªôÁõÆÊ†áÂÖÖÁîµ„Äë----"),await _u(),await sa(),vu())try{const t=oa.bCoinCouponBalance||0,e=ia.CHARGE_ID;let n=0;Uo.info(`b Â∏ÅÂà∏‰ΩôÈ¢ù${t}`);const r=async()=>{const{code:n,message:r,data:i}=await function(t=50,e=!0,n=ia.USERID,r="up",i=n){return Lc.post("/x/ugcpay/web/v2/trade/elec/pay/quick",{csrf:ia.BILIJCT,bp_num:t,is_bp_remains_prior:e,up_mid:n,otype:r,oid:i})}(t,!0,e);0===n?(Uo.info(`„ÄêÂÖÖÂÄºÁªìÊûú„Äë${wu[i.status]}`),i.status===wu["ÊàêÂäü"]&&(oa.chargeOrderNo=i.order_no,await sa(),await async function(){try{if(!oa.chargeOrderNo)return!1;const t=p[$o(0,p.length-1)],{code:e}=await function(t,e="ÊîØÊåÅÂ§ß‰Ω¨‰∏ÄÊ≥¢"){return Lc.post("/x/ugcpay/trade/elec/message",{csrf:ia.BILIJCT,message:e,order_id:t})}(oa.chargeOrderNo,t);0===e&&Uo.info("ÁïôË®ÄÊàêÂäüÔºÅ")}catch{}}())):Uo.warn(`ÂÖÖÁîµÂ§±Ë¥•Ôºö${n} ${r}`)};for(oa.chargeOrderNo="";!(oa.chargeOrderNo||(await r(),await sa(),n++>2)););}catch(t){Uo.error(`ÂÖÖÁîµÂá∫Áé∞ÂºÇÂ∏∏Ôºö${t.message}`)}},getVipPrivilege:async function(){try{if(Uo.info("----„ÄêÈ¢ÜÂèñÂ§ß‰ºöÂëòÊùÉÁõä„Äë----"),2!==oa.vipType)return Uo.info("Ë¥¶Âè∑ÈùûÂπ¥Â∫¶Â§ß‰ºöÂëòÔºå‰∏çÈúÄË¶ÅÈ¢ÜÂèñÊùÉÁõä"),!1;const t=await bu();if(0===t.length)return void Uo.info("Â∑≤ÁªèÈ¢ÜÂèñËøáÊùÉÁõäÔºå‰∏çÈúÄË¶ÅÂÜçÈ¢ÜÂèñ");for(let e=0;e<t.length;e++){const n=t[e];await Tu(n.type)}}catch(t){Uo.error(`È¢ÜÂèñÂ§ß‰ºöÂëòÊùÉÁõäÂá∫Áé∞ÂºÇÂ∏∏Ôºö${t.message}`)}},giveGift:async function(){Uo.info("----„ÄêÊäïÂñÇËøáÊúüÈ£üÁâ©„Äë----");try{const t=await Iu();if(await sa(),null==t||!t.length)return void Uo.info("Ê≤°Êúâ2Â§©ÂÜÖËøáÊúüÁöÑÁÆÄÂçïÁ§ºÁâ©");const e=await async function(){const t=Object.assign([],ia.BILI_GIFT_UP),e=()=>t.splice($o(ia.BILI_GIFT_UP.length-1),1)[0];for(;t.length;){const t=e(),n=await Ou(t);if(n)return{mid:t,...n}}return await async function(){const{data:{count:t,items:e}}=await jc();if(await sa(),!t)return;const n=e[$o(e.length-1)];return{mid:n.target_id,roomid:n.roomid||0,name:n.uname}}()}();if(!e)return void Uo.info("Ê≤°ÊúâÊâæÂà∞ÊäïÂñÇÁõÆÊ†á");await async function({roomid:t,mid:e,name:n},r){for(const i of r){await sa();try{const{code:r,message:o,data:a}=await Bc({roomid:t,ruid:e,bag_id:i.bag_id,gift_id:i.gift_id,gift_num:i.gift_num});if(0!==r){Uo.warn(`Âêë[${n}]ÊäïÂñÇ[${i.gift_name}]Ôºå${o}`);continue}a.gift_list.forEach((t=>{Uo.info(`ÊàêÂäüÁªô [${n}] ÊäïÂñÇ${t.gift_name}`)}))}catch{}}}(e,t)}catch(t){Uo.info(`ÊäïÂñÇËøáÊúüÈ£üÁâ©ÂºÇÂ∏∏ ${t}`)}},matchGame:async function(){if(Uo.info("----„ÄêËµõ‰∫ãÁ°¨Â∏ÅÁ´ûÁåú„Äë----"),ia.MATCH_COINS<=0)return void Uo.info("Á°¨Â∏ÅÊï∞Èáè‰∏çËÉΩÂ∞è‰∫é 0");if(Cu())return;const t=await async function(){try{const{code:t,message:e,data:{list:n,page:r}}=await function(t="",e=""){return Lc.get(`/x/esports/guess/collection/question?pn=1&ps=50&gid=&sids=&stime=${t}&etime=${e}`)}();return 0!==t?void Uo.warn(`Ëé∑ÂèñËµõ‰∫ãÈîôËØØ ${t} ${e}`):0===r.total?(Uo.info("‰ªäÊó•Â∑≤ÁªèÊó†Ê≥ïËé∑ÂèñËµõ‰∫ã"),null):n}catch(t){}}();if(await sa(),!t)return;const e=await async function(t){let e=0;try{for(const n of t){const{contest:t,questions:r}=n,i=t.id,[{id:o,title:a,details:s,is_guess:c}]=r,[u,f]=s;if(Cu())return e;if(c)continue;Uo.info(`${a} <=> ${u.odds}:${f.odds}`);const l=u.odds>f.odds;let d;d=ia.MATCH_SELECTION>0?l?f:u:l?u:f,Uo.info(`È¢ÑÊµã[ ${d.option} ] ${ia.MATCH_COINS} È¢óÁ°¨Â∏Å`),await sa();const{code:p}=await Eu(i,o,d.detail_id,ia.MATCH_COINS);0!==p?Uo.info("È¢ÑÊµãÂ§±Ë¥•"):(e++,oa.money-=ia.MATCH_COINS)}}catch(t){console.warn(t.message)}return e}(function(t,e){return t.filter((t=>{const{questions:n}=t,[{details:r,is_guess:i}]=n;if(i)return!1;const[o,a]=r;return Math.abs(o.odds-a.odds)>=e}))}(t,ia.MATCH_DIFF));Uo.info(`„ÄêÁ´ûÁåúÁªìÊùü„Äë‰∏ÄÂÖ±ÂèÇ‰∏é${e}Ê¨°È¢ÑÊµã`)},liveLottery:async function(){Uo.info("----„ÄêÂ§©ÈÄâÊó∂Âàª„Äë----");const t=await Zu();if(!t)return t;try{const t=await Pu();Uo.info(`ÊúÄÂêé‰∏Ä‰∏™ÂÖ≥Ê≥®ÁöÑUP: ${t.uname}`);const e=await async function(){Gu=[];const{pageNum:t}=ia.lottery,e=await Mu();for(const n of e)for(const e of n)await Ju(e.areaId,e.parentId,t);return Gu}();Uo.info("Êâ´ÊèèÂÆåÊàê");const n=[];await Nu(n,e,null==t?void 0:t.mid),await Lu(n),Uo.info("ÁßªÂä®ÂÖ≥Ê≥®UPÂà∞ÂàÜÁªÑÊàêÂäü")}catch(t){Uo.warn(`Â§©ÈÄâÊó∂ÂàªÂºÇÂ∏∏: ${t.message}`),Uo.debug(t)}Uo.info("ÁªìÊùüÂ§©ÈÄâÊó∂Âàª")},liveRedPack:async function(){Uo.info("----„ÄêÂ§©ÈÄâÁ∫¢ÂåÖ„Äë----");try{const t=await Pu();Uo.info(`ÊúÄÂêé‰∏Ä‰∏™ÂÖ≥Ê≥®ÁöÑUP: ${t.uname}`);const e=await async function(){Gu=[];const{pageNum:t}=ia.lottery,e=await Mu();for(const n of e)for(const e of n)await Wu(e.areaId,e.parentId,t);return Gu}();Uo.info("Êâ´ÊèèÂÆåÊàêÔºåËé∑ÂèñÊñ∞ÂÖ≥Ê≥®ÁöÑUP");const n=[];await Nu(n,e,null==t?void 0:t.mid),Uo.info("ÂºÄÂßãËØªÂèñÊ∂àÊÅØ"),await ef(n),Uo.info("ÁßªÂä®ÂÖ≥Ê≥®UPÂà∞ÂàÜÁªÑ"),await Lu(n),Uo.info("ÁßªÂä®ÂÖ≥Ê≥®UPÂà∞ÂàÜÁªÑÊàêÂäü")}catch(t){Uo.warn(`Â§©ÈÄâÊó∂ÂàªÂºÇÂ∏∏: ${t.message}`),Uo.debug(t)}Uo.info("ÁªìÊùüÂ§©ÈÄâÁ∫¢ÂåÖ")},liveIntimacy:async function(){Uo.info("----„ÄêÁõ¥Êí≠‰∫≤ÂØÜÂ∫¶„Äë----");try{await hu(),Uo.info("Áõ¥Êí≠‰∫≤ÂØÜÂ∫¶ÂÆåÊàê")}catch(t){Uo.error(`Áõ¥Êí≠‰∫≤ÂØÜÂ∫¶: ${t.message}`)}}};async function of(t,...e){Ao.pushValue="";try{await async function(){Uo.info("----„ÄêÁôªÂΩï„Äë----");const{data:t,message:e,code:n}=await Gc();if(0!==n)throw Uo.error(`ÁôªÂΩïÈîôËØØ ${n} ${e}`),new Error(e);if(!t.isLogin)throw new Error("Êé•Âè£ËøîÂõû‰∏∫Êú™ÁôªÂΩï");await sa(),await Hc(t)}()}catch(t){return Uo.error(`ÁôªÂΩïÂ§±Ë¥•: ${t}`),await Pc("ÁôªÂΩïÂ§±Ë¥•",Ao.pushValue),"Êú™ÂÆåÊàê"}const n=gc([...Object.values(rf)]);for(const t of n)try{await t()}catch(e){Uo.error(`${t.name}Â§±Ë¥•: ${e}`)}finally{await sa()}return t&&await t(...e),await Pc("ÊØèÊó•ÂÆåÊàê",Ao.pushValue),"ÂÆåÊàê"}function af(t,e,n,r,i){const o=Wo(ia.COOKIE),a=o,s=[Vo(ia.COOKIE),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const e=c.randomBytes(1)[0]%16;return("x"===t?e:3&e|8).toString(16)}))];return{ua:ia.USER_AGENT,id:[n,e,i,t],csrf_token:o,csrf:a,device:s,uname:r}}async function sf(){try{await dc.get("https://api.live.bilibili.com/relation/v1/Feed/heartBeat")}catch{}}async function cf(t){const{data:{area_id:e,parent_area_id:n,room_id:r}}=await function(t){return kc.get(`/room/v1/Room/get_info?room_id=${t}&from=room`)}(t);return{room_id:r,area_id:e,parent_area_id:n}}async function uf(t,e){const n={id:JSON.stringify(t.id),device:JSON.stringify(t.device),ts:(new Date).getTime(),is_patch:0,heart_beat:"[]",ua:t.ua,visit_id:"",csrf:t.csrf,csrf_token:t.csrf_token};try{const{data:r,code:i}=await function(t){return dc.post("https://live-trace.bilibili.com/xlive/data-interface/v1/x25Kn/E",t)}(n);if(0===i)return Uo.info(`ËøõÂÖ•„Äê${t.uname}„ÄëÁöÑÁõ¥Êí≠Èó¥`),e.v++,r}catch(t){Uo.verbose(t)}}async function ff(t,e,n){if(n.v>6)return;const r={id:JSON.stringify(e.id),device:JSON.stringify(e.device),ets:t.timestamp,benchmark:t.secret_key,time:60,ts:(new Date).getTime(),ua:e.ua},i=function(t,e){const[n,r,i,o]=JSON.parse(t.id),[a,s]=JSON.parse(t.device),{ets:u,time:f,ts:l}=t,d={platform:"web",parent_id:n,area_id:r,seq_id:i,room_id:o,buvid:a,uuid:s,ets:u,time:f,ts:l},p=t.benchmark,g=["MD5","SHA1","SHA256","SHA224","SHA512","SHA384"];let m=JSON.stringify(d);for(const t of e)m=c.createHmac(g[t],p).update(m).digest("hex");return m}(r,t.secret_rule);try{const{data:t,code:o,message:a}=await function(t){return dc.post("https://live-trace.bilibili.com/xlive/data-interface/v1/x25Kn/X",t)}(Object.assign({visit_id:"",csrf:e.csrf,csrf_token:e.csrf_token,s:i},r));return 0===o?(Uo.info(`Âêë„Äê${e.uname}„ÄëÂèëÈÄÅÁ¨¨${n.v}Ê¨°ÂøÉË∑≥`),n.v++):Uo.warn(`Âêë„Äê${e.uname}„ÄëÂèëÈÄÅÁ¨¨${n.v}Ê¨°ÂøÉË∑≥Â§±Ë¥• ${o} ${a}`),t}catch(t){Uo.verbose(t)}}async function lf(t=1,e=10){try{const{code:n,message:r,data:i}=await jc(t,e);return 0!==n?(Uo.verbose(`Ëé∑ÂèñÁõ¥Êí≠Èó¥Â§±Ë¥• ${n} ${r}`),null):i}catch(t){return Uo.verbose(`Ëé∑ÂèñÁõ¥Êí≠Èó¥ÂºÇÂ∏∏ ${t.message}`),null}}async function df(t=!0){const e=await async function(){let t=0;try{var e,n;const{data:r,code:i}=await Uc();return 0!==i||(null===(e=r.list)||void 0===e?void 0:e.length)<=0?24:(null===(n=r.list)||void 0===n||n.forEach((e=>{if(30607===e.gift_id){const n=(1e3*e.expire_at-(new Date).getTime())/864e5;n>6&&n<=7&&(t+=e.gift_num)}})),t>=24?0:24-t)}catch(t){}return 24}();let n;return t?n=await async function(){const{items:t,page_info:e}=await lf();let{total_page:n}=e;if(n&&n>1){n=n>3?3:n;for(let e=2;e<=n;e++){const n=await lf(e,10);t.push(...n.items)}}return t}():({items:n}=await lf()),{fansMedalList:n,heartNum:e}}async function pf(t){let e,n;if(t){const{d:r,hn:i}=JSON.parse(t);e="string"==typeof r?JSON.parse(oo(r)):r||[{seq:{v:0}}],n=i||{v:0}}else e=[{seq:{v:0}}],n={v:0};let r=0;if(e[0]&&!e[0].seq.v){e.length=0;const{heartNum:t,fansMedalList:i}=await df();n.v=t;for(const t of i){if(0===n.v)return Uo.info("‰ªäÊó•Ëé∑ÂèñÂ∞èÊòüÊòüÂ∑≤ÁªèËææÂà∞ 24"),0;if(r>=n.v)break;const{roomid:i,uname:o}=t,{room_id:a,area_id:s,parent_area_id:c}=await cf(i),u={v:0},f=af(a,s,c,o,u.v);await sf(),await sa(500);const l=await uf(f,u);e.push({data:l,baseData:f,seq:u}),r++}}else{!function(t){const e=Vo(ia.COOKIE),n=Wo(ia.COOKIE),r=ia.USER_AGENT;t.forEach((t=>{t.baseData.ua=r,t.baseData.csrf=t.baseData.csrf_token=n,t.baseData.device[0]=e,t.baseData.id[2]=t.seq.v}))}(e);for(const t of e)if(await sf(),t.data&&(t.data=await ff(t.data,t.baseData,t.seq)),await sa(1e3),r++,t.seq.v>5&&(t.seq.v=0,r>=n.v))return Uo.info("‰ªäÊó•Ëé∑ÂèñÂ∞èÂøÉÂøÉÂÆåÊàê"),0;if(e.find((t=>t.seq.v>5)))return 1}return function(t){t.forEach((t=>{delete t.baseData.csrf,delete t.baseData.csrf_token,delete t.baseData.ua,t.baseData.device[0]=0}))}(e),{d:io(JSON.stringify(e)),hn:n,l:e.length}}function gf(t,e){return"scf"===t?e.Message:e.payload}async function mf(t,e,n){const r="scf"===t?(await Promise.resolve().then((function(){return yf}))).default:(await Promise.resolve().then((function(){return _f}))).default;return(...t)=>r(e,n,...t)}var hf=Object.freeze({__proto__:null,dailyHandle:async function({event:t,context:e,slsType:n}){const r=gf(n,t),i=await mf(n,t,e);let o;try{o=JSON.parse(r)}catch(t){}return o&&o.lastTime===wo().getDate().toString()?"‰ªäÊó•ÈáçÂ§çÊâßË°å":await of(i)},liveHeartHandle:async function({event:t,context:e,slsType:n}){const r=gf(n,t),i=await mf(n,t,e);let o;try{o=JSON.parse(r)}catch(t){}if(o&&!o.d&&o.lastTime===wo().getDate().toString())return"‰ªäÊó•ÈáçÂ§çÊâßË°å";const a=await pf(r);return 0===a?(await i(),"‰ªäÊó•ÂÆåÊàê"):1===a?(await i({hn:{v:0},d:[{seq:{v:0}}]},bo(5e3,n)),"Á≠âÂæÖÁªßÁª≠‰∏ã‰∏ÄËΩÆÂøÉË∑≥"):(await i(a,bo(62e3-1e3*a.l,n)),"Á≠âÂæÖÁªßÁª≠‰∏ãÊ¨°ÂøÉË∑≥")}});var yf=Object.freeze({__proto__:null,default:async function(t,e,n,r,i=2){if(!t.TriggerName)return!1;if(!process.env.TENCENT_SECRET_ID||!process.env.TENCENT_SECRET_KEY)return Uo.info("ÁéØÂ¢ÉÂèòÈáè‰∏çÂ≠òÂú®TENCENT_SECRET_IDÂíåTENCENT_SECRET_KEY"),!1;const o=await async function(){try{return await Promise.resolve().then((function(){return s(require("tencentcloud-sdk-nodejs"))}))}catch{Uo.warn("tencentcloud-sdk-nodejs not foundÔºåËøêË°å cd src && yarn add tencentcloud-sdk-nodejs")}}();if(!o)return!1;const a=o.scf.v20180416.Client,c=e.function_name,u=t.TriggerName,f=new a({credential:{secretId:process.env.TENCENT_SECRET_ID,secretKey:process.env.TENCENT_SECRET_KEY},region:e.tencentcloud_region,profile:{httpProfile:{endpoint:"scf.tencentcloudapi.com"}}});async function l(){const t=r||To(ia.dailyRunTime,"scf"),e={FunctionName:c,TriggerName:u,Type:"timer",TriggerDesc:t.value,Qualifier:"$DEFAULT"},i=await async function(){try{const{Triggers:t}=await f.ListTriggers({FunctionName:c});return-1!==(null==t?void 0:t.findIndex((t=>t.TriggerName===u)))}catch({code:t,message:e}){return Uo.error(`Ëé∑ÂèñtriggerÂ§±Ë¥• ${t} => ${e}`),!1}}();if(Uo.info(`‰øÆÊîπÊó∂Èó¥‰∏∫Ôºö${t.string}`),i){const t=await async function(t){try{return await f.DeleteTrigger(t)}catch({code:t,message:e}){return Uo.warn(`Âà†Èô§triggerÂ§±Ë¥• ${t} => ${e}`),!1}}(e);if(!t)return}return!!await async function(t){const e=wo();t.CustomArgument=JSON.stringify({...n,lastTime:e.getDate().toString()});try{return await f.CreateTrigger(t)}catch({code:t,message:e}){return Uo.error(`ÂàõÂª∫triggerÂ§±Ë¥• ${t} => ${e}`),!1}}(e)}let d=!1;for(;!d&&i;)d=await l(),i--;return d}});var _f=Object.freeze({__proto__:null,default:async function(t,e,n,r,i=2){if(!t.triggerName)return!1;if(!process.env.ALI_SECRET_ID||!process.env.ALI_SECRET_KEY)return Uo.info("ÁéØÂ¢ÉÂèòÈáè‰∏çÂ≠òÂú®ALI_SECRET_IDÂíåALI_SECRET_KEY"),!1;const o=await async function(){try{return await Promise.resolve().then((function(){return s(require("@alicloud/fc2"))}))}catch{Uo.warn("@alicloud/fc2 not foundÔºåËøêË°å yarn add @alicloud/fc2")}}();if(!o)return!1;const a=o.default,c=e.function.name,u=t.triggerName,f=e.service.name,l=new a(e.accountId,{accessKeyID:process.env.ALI_SECRET_ID,accessKeySecret:process.env.ALI_SECRET_KEY,region:e.region});async function d(){const t=r||To(ia.dailyRunTime,"fc");return Uo.info(`‰øÆÊîπÊó∂Èó¥‰∏∫Ôºö${t.string}`),!!await async function(t){const e=wo(),r=`CRON_TZ=Asia/Shanghai ${t}`;try{return await l.updateTrigger(f,c,u,{triggerConfig:{cronExpression:r,payload:JSON.stringify({...n,lastTime:e.getDate().toString()})}})}catch(t){return Uo.error(`Êõ¥Êñ∞triggerÂ§±Ë¥• ${t.message}`),!1}}(t.value)}let p=!1;for(;!p&&i;)p=await d(),i--;return p}});
